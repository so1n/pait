
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Pait(π tool) - Python Modern API Tools, easier to use web frameworks/write API routing">
      
      
      
      
        <link rel="prev" href="../3_2_openapi_route/">
      
      
        <link rel="next" href="../4_unit_test_helper/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.8">
    
    
      
        <title>Security - Pait</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../termynal.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#1apikey" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Pait" class="md-header__button md-logo" aria-label="Pait" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pait
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Security
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/pait/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/pait-zh-doc/" hreflang="zh" class="md-select__link">
              中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/so1n/pait" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    so1n/pait
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Pait" class="md-nav__button md-logo" aria-label="Pait" data-md-component="logo">
      
  <img src="../assets/logo.png" alt="logo">

    </a>
    Pait
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/so1n/pait" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    so1n/pait
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Type conversion and parameter validation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Type conversion and parameter validation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_1_introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_2_how_to_use_field/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use Field
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_3_how_to_use_type/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use Type
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_4_depend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Depend
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../1_5_exception/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exception
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../2_how_to_use_pait/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to use Pait decorator
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    OpenAPI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            OpenAPI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_1_openapi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAPI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_2_openapi_route/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    OpenAPI Route
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Security
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1apikey" class="md-nav__link">
    1.APIKey
  </a>
  
    <nav class="md-nav" aria-label="1.APIKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11combination-of-apikey-and-links" class="md-nav__link">
    1.1.Combination of APIKey and Links
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2http" class="md-nav__link">
    2.HTTP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3oauth2" class="md-nav__link">
    3.Oauth2
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../4_unit_test_helper/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unit test helper
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Plugin
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Plugin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_1_introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_2_param_check_plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parameter checking plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_3_json_response_plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Json response plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_4_mock_json_response_check_plugin/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mock response plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_5_cache_response/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Response caching plugin
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_x_how_tp_customize_the_plugin.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to customize plugins
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../6_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    config
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../7_gRPC_gateway/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    gRPC Gateway
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../8_other/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Other
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1apikey" class="md-nav__link">
    1.APIKey
  </a>
  
    <nav class="md-nav" aria-label="1.APIKey">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11combination-of-apikey-and-links" class="md-nav__link">
    1.1.Combination of APIKey and Links
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2http" class="md-nav__link">
    2.HTTP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3oauth2" class="md-nav__link">
    3.Oauth2
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Security</h1>

<p>OpenAPI provides support for basic HTTP authentication through <code>security</code>, but different web frameworks implement basic HTTP authentication in different ways.
So <code>Pait</code> provides simple support for OpenAPI's security through <code>Depends</code> (<code>api key</code>, <code>http</code>, <code>oauth2</code>), which simplifies the use of security in different web frameworks.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>advanced authentication such as jwt will be supported through other package in the future.</p>
</div>
<h2 id="1apikey">1.APIKey</h2>
<p><code>API Key</code> is the simplest method in Security, and because of its simplicity, it has the most usage scenarios.
<code>Pait</code> provides <code>APIKey</code> class to support the use of <code>API Key</code>, the usage is as follows:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Flask</label><label for="__tabbed_1_2">Starlette</label><label for="__tabbed_1_3">Sanic</label><label for="__tabbed_1_4">Tornado</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/flask_with_apikey_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">from</span> <span class="nn">pait.app.flask</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">from</span> <span class="nn">pait.app.flask.security</span> <span class="kn">import</span> <span class="n">api_key</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Cookie</span><span class="p">,</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Query</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="hll"><span class="n">token_cookie_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Cookie</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-cookie-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="hll"><span class="n">token_header_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Header</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-header-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="hll"><span class="n">token_query_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-query-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="hll"><span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="hll"><span class="k">def</span> <span class="nf">api_key_cookie_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_cookie_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="hll">    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">}</span>
</span><a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="hll">
</span><a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="hll">
</span><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="hll"><span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="hll"><span class="k">def</span> <span class="nf">api_key_header_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_header_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="hll">    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">}</span>
</span><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="hll">
</span><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="hll">
</span><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="hll"><span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="hll"><span class="k">def</span> <span class="nf">api_key_query_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_query_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="hll">    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">}</span>
</span><a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">)</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/api-cookie-key&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">api_key_cookie_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/api-header-key&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">api_key_header_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/api-query-key&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">api_key_query_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/starlette_with_apikey_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span>
<span class="normal"><a href="#__codelineno-1-54">54</a></span>
<span class="normal"><a href="#__codelineno-1-55">55</a></span>
<span class="normal"><a href="#__codelineno-1-56">56</a></span>
<span class="normal"><a href="#__codelineno-1-57">57</a></span>
<span class="normal"><a href="#__codelineno-1-58">58</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">from</span> <span class="nn">starlette.applications</span> <span class="kn">import</span> <span class="n">Starlette</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">from</span> <span class="nn">starlette.responses</span> <span class="kn">import</span> <span class="n">JSONResponse</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="kn">from</span> <span class="nn">starlette.routing</span> <span class="kn">import</span> <span class="n">Route</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="kn">from</span> <span class="nn">pait.app.starlette</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="kn">from</span> <span class="nn">pait.app.starlette.security</span> <span class="kn">import</span> <span class="n">api_key</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Cookie</span><span class="p">,</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Query</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="hll"><span class="n">token_cookie_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Cookie</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-cookie-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="hll"><span class="n">token_header_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Header</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-header-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="hll"><span class="n">token_query_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-1-23" name="__codelineno-1-23"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-query-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-1-28" name="__codelineno-1-28"></a>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="hll"><span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-1-31" name="__codelineno-1-31"></a><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">api_key_cookie_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_cookie_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="hll">    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span><a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="hll">
</span><a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="hll">
</span><a id="__codelineno-1-35" name="__codelineno-1-35"></a><span class="hll"><span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">api_key_header_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_header_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="hll">    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span><a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="hll">
</span><a id="__codelineno-1-39" name="__codelineno-1-39"></a><span class="hll">
</span><a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="hll"><span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">api_key_query_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_query_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="hll">    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span><a id="__codelineno-1-43" name="__codelineno-1-43"></a>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Starlette</span><span class="p">(</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a>    <span class="n">routes</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a>        <span class="n">Route</span><span class="p">(</span><span class="s2">&quot;/api/api-cookie-key&quot;</span><span class="p">,</span> <span class="n">api_key_cookie_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">]),</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a>        <span class="n">Route</span><span class="p">(</span><span class="s2">&quot;/api/api-header-key&quot;</span><span class="p">,</span> <span class="n">api_key_header_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">]),</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a>        <span class="n">Route</span><span class="p">(</span><span class="s2">&quot;/api/api-query-key&quot;</span><span class="p">,</span> <span class="n">api_key_query_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">]),</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a>    <span class="p">]</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="p">)</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a>    <span class="kn">import</span> <span class="nn">uvicorn</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/sanic_with_apikey_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span>
<span class="normal"><a href="#__codelineno-2-32">32</a></span>
<span class="normal"><a href="#__codelineno-2-33">33</a></span>
<span class="normal"><a href="#__codelineno-2-34">34</a></span>
<span class="normal"><a href="#__codelineno-2-35">35</a></span>
<span class="normal"><a href="#__codelineno-2-36">36</a></span>
<span class="normal"><a href="#__codelineno-2-37">37</a></span>
<span class="normal"><a href="#__codelineno-2-38">38</a></span>
<span class="normal"><a href="#__codelineno-2-39">39</a></span>
<span class="normal"><a href="#__codelineno-2-40">40</a></span>
<span class="normal"><a href="#__codelineno-2-41">41</a></span>
<span class="normal"><a href="#__codelineno-2-42">42</a></span>
<span class="normal"><a href="#__codelineno-2-43">43</a></span>
<span class="normal"><a href="#__codelineno-2-44">44</a></span>
<span class="normal"><a href="#__codelineno-2-45">45</a></span>
<span class="normal"><a href="#__codelineno-2-46">46</a></span>
<span class="normal"><a href="#__codelineno-2-47">47</a></span>
<span class="normal"><a href="#__codelineno-2-48">48</a></span>
<span class="normal"><a href="#__codelineno-2-49">49</a></span>
<span class="normal"><a href="#__codelineno-2-50">50</a></span>
<span class="normal"><a href="#__codelineno-2-51">51</a></span>
<span class="normal"><a href="#__codelineno-2-52">52</a></span>
<span class="normal"><a href="#__codelineno-2-53">53</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">HTTPResponse</span><span class="p">,</span> <span class="n">Sanic</span><span class="p">,</span> <span class="n">json</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="kn">from</span> <span class="nn">pait.app.sanic</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="kn">from</span> <span class="nn">pait.app.sanic.security</span> <span class="kn">import</span> <span class="n">api_key</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Cookie</span><span class="p">,</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Query</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="hll"><span class="n">token_cookie_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Cookie</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-cookie-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="hll"><span class="n">token_header_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Header</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-header-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="hll"><span class="n">token_query_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-query-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-2-26" name="__codelineno-2-26"></a>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="hll"><span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">api_key_cookie_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_cookie_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">HTTPResponse</span><span class="p">:</span>
</span><a id="__codelineno-2-30" name="__codelineno-2-30"></a><span class="hll">    <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span><a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="hll">
</span><a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="hll">
</span><a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="hll"><span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">api_key_header_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_header_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">HTTPResponse</span><span class="p">:</span>
</span><a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="hll">    <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span><a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="hll">
</span><a id="__codelineno-2-37" name="__codelineno-2-37"></a><span class="hll">
</span><a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="hll"><span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">api_key_query_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_query_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">HTTPResponse</span><span class="p">:</span>
</span><a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="hll">    <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span><a id="__codelineno-2-41" name="__codelineno-2-41"></a>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;demo&quot;</span><span class="p">)</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">api_key_cookie_route</span><span class="p">,</span> <span class="s2">&quot;/api/api-cookie-key&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">api_key_header_route</span><span class="p">,</span> <span class="s2">&quot;/api/api-header-key&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">api_key_query_route</span><span class="p">,</span> <span class="s2">&quot;/api/api-query-key&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a>    <span class="kn">import</span> <span class="nn">uvicorn</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/tornado_with_apikey_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span>
<span class="normal"><a href="#__codelineno-3-26">26</a></span>
<span class="normal"><a href="#__codelineno-3-27">27</a></span>
<span class="normal"><a href="#__codelineno-3-28">28</a></span>
<span class="normal"><a href="#__codelineno-3-29">29</a></span>
<span class="normal"><a href="#__codelineno-3-30">30</a></span>
<span class="normal"><a href="#__codelineno-3-31">31</a></span>
<span class="normal"><a href="#__codelineno-3-32">32</a></span>
<span class="normal"><a href="#__codelineno-3-33">33</a></span>
<span class="normal"><a href="#__codelineno-3-34">34</a></span>
<span class="normal"><a href="#__codelineno-3-35">35</a></span>
<span class="normal"><a href="#__codelineno-3-36">36</a></span>
<span class="normal"><a href="#__codelineno-3-37">37</a></span>
<span class="normal"><a href="#__codelineno-3-38">38</a></span>
<span class="normal"><a href="#__codelineno-3-39">39</a></span>
<span class="normal"><a href="#__codelineno-3-40">40</a></span>
<span class="normal"><a href="#__codelineno-3-41">41</a></span>
<span class="normal"><a href="#__codelineno-3-42">42</a></span>
<span class="normal"><a href="#__codelineno-3-43">43</a></span>
<span class="normal"><a href="#__codelineno-3-44">44</a></span>
<span class="normal"><a href="#__codelineno-3-45">45</a></span>
<span class="normal"><a href="#__codelineno-3-46">46</a></span>
<span class="normal"><a href="#__codelineno-3-47">47</a></span>
<span class="normal"><a href="#__codelineno-3-48">48</a></span>
<span class="normal"><a href="#__codelineno-3-49">49</a></span>
<span class="normal"><a href="#__codelineno-3-50">50</a></span>
<span class="normal"><a href="#__codelineno-3-51">51</a></span>
<span class="normal"><a href="#__codelineno-3-52">52</a></span>
<span class="normal"><a href="#__codelineno-3-53">53</a></span>
<span class="normal"><a href="#__codelineno-3-54">54</a></span>
<span class="normal"><a href="#__codelineno-3-55">55</a></span>
<span class="normal"><a href="#__codelineno-3-56">56</a></span>
<span class="normal"><a href="#__codelineno-3-57">57</a></span>
<span class="normal"><a href="#__codelineno-3-58">58</a></span>
<span class="normal"><a href="#__codelineno-3-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="kn">import</span> <span class="n">IOLoop</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="kn">from</span> <span class="nn">tornado.web</span> <span class="kn">import</span> <span class="n">Application</span><span class="p">,</span> <span class="n">RequestHandler</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="kn">from</span> <span class="nn">pait.app.tornado</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="kn">from</span> <span class="nn">pait.app.tornado.security</span> <span class="kn">import</span> <span class="n">api_key</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Cookie</span><span class="p">,</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Header</span><span class="p">,</span> <span class="n">Query</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="hll"><span class="n">token_cookie_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Cookie</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-cookie-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-3-14" name="__codelineno-3-14"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="hll"><span class="n">token_header_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Header</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-3-19" name="__codelineno-3-19"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-header-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="hll"><span class="n">token_query_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
</span><a id="__codelineno-3-22" name="__codelineno-3-22"></a><span class="hll">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
</span><a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="n">openapi_include</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="hll">    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
</span><a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="hll">    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-query-api-key&quot;</span><span class="p">,</span>
</span><a id="__codelineno-3-26" name="__codelineno-3-26"></a><span class="hll"><span class="p">)</span>
</span><a id="__codelineno-3-27" name="__codelineno-3-27"></a>
<a id="__codelineno-3-28" name="__codelineno-3-28"></a>
<a id="__codelineno-3-29" name="__codelineno-3-29"></a><span class="hll"><span class="k">class</span> <span class="nc">APIKeyCookieHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
</span><a id="__codelineno-3-30" name="__codelineno-3-30"></a><span class="hll">    <span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-3-31" name="__codelineno-3-31"></a><span class="hll">    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_cookie_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="__codelineno-3-32" name="__codelineno-3-32"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span><a id="__codelineno-3-33" name="__codelineno-3-33"></a><span class="hll">
</span><a id="__codelineno-3-34" name="__codelineno-3-34"></a><span class="hll">
</span><a id="__codelineno-3-35" name="__codelineno-3-35"></a><span class="hll"><span class="k">class</span> <span class="nc">APIKeyHeaderHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
</span><a id="__codelineno-3-36" name="__codelineno-3-36"></a><span class="hll">    <span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-3-37" name="__codelineno-3-37"></a><span class="hll">    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_header_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="__codelineno-3-38" name="__codelineno-3-38"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span><a id="__codelineno-3-39" name="__codelineno-3-39"></a><span class="hll">
</span><a id="__codelineno-3-40" name="__codelineno-3-40"></a><span class="hll">
</span><a id="__codelineno-3-41" name="__codelineno-3-41"></a><span class="hll"><span class="k">class</span> <span class="nc">APIKeyQueryHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
</span><a id="__codelineno-3-42" name="__codelineno-3-42"></a><span class="hll">    <span class="nd">@pait</span><span class="p">()</span>
</span><a id="__codelineno-3-43" name="__codelineno-3-43"></a><span class="hll">    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_query_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="__codelineno-3-44" name="__codelineno-3-44"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
</span><a id="__codelineno-3-45" name="__codelineno-3-45"></a>
<a id="__codelineno-3-46" name="__codelineno-3-46"></a>
<a id="__codelineno-3-47" name="__codelineno-3-47"></a><span class="n">app</span><span class="p">:</span> <span class="n">Application</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span>
<a id="__codelineno-3-48" name="__codelineno-3-48"></a>    <span class="p">[</span>
<a id="__codelineno-3-49" name="__codelineno-3-49"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/api-cookie-key&quot;</span><span class="p">,</span> <span class="n">APIKeyCookieHandler</span><span class="p">),</span>
<a id="__codelineno-3-50" name="__codelineno-3-50"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/api-header-key&quot;</span><span class="p">,</span> <span class="n">APIKeyHeaderHandler</span><span class="p">),</span>
<a id="__codelineno-3-51" name="__codelineno-3-51"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/api-query-key&quot;</span><span class="p">,</span> <span class="n">APIKeyQueryHandler</span><span class="p">),</span>
<a id="__codelineno-3-52" name="__codelineno-3-52"></a>    <span class="p">],</span>
<a id="__codelineno-3-53" name="__codelineno-3-53"></a><span class="p">)</span>
<a id="__codelineno-3-54" name="__codelineno-3-54"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-3-55" name="__codelineno-3-55"></a>
<a id="__codelineno-3-56" name="__codelineno-3-56"></a>
<a id="__codelineno-3-57" name="__codelineno-3-57"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-3-58" name="__codelineno-3-58"></a>    <span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>
<a id="__codelineno-3-59" name="__codelineno-3-59"></a>    <span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>The first highlighting code is initialized for the different <code>APIKey</code> fields,
which use slightly different parameters, see the table below for parameter meanings:</p>
<table>
<thead>
<tr>
<th>Parameters</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>name</td>
<td>The name of the <code>APIKey</code> field</td>
</tr>
<tr>
<td>field</td>
<td>The <code>APIKey</code> field corresponds to the Field class in <code>Pait</code>, <code>API Key</code> only supports Query, Header and Cookie parameters, so only <code>field.Query</code>, <code>field.Header</code>, <code>field.Cookie</code> are allowed</td>
</tr>
<tr>
<td>verify_api_key_callable</td>
<td>A function that checks <code>APIKey</code>, <code>Pait</code> extracts the <code>APIKey</code> value from the request body and passes it to the function for processing, if the function returns <code>True</code> then the check passes, and vice versa then the check fails.</td>
</tr>
<tr>
<td>security_name</td>
<td>Specify the name of the security, the name of <code>APIKey</code> must be different for different roles, the default value is the class name of APIKey.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to use APIKey properly in the OpenAPI tool, the <code>Field</code> must be initialized with the <code>openapi_include</code> attribute False.</p>
</div>
<p>The second highlighted piece of code connects APIKey to the route function via <code>Depend</code>,
where the argument to <code>Depend</code> is an instance of <code>APIKey</code>.
When the route function receives a request <code>Pait</code> automatically extracts the value of <code>APIKey</code> from the request body and passes it to <code>APIKey</code>'s <code>verify_api_key_callable</code> function for verification,
if it passes the verification the value is injected into the route function for execution,
and vice versa <code>401</code> is returned.</p>
<p>After running the code, execute the following command to see the execution effect of <code>APIKey</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Success Result</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/api-cookie-key&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Cookie: token=token&#39;</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="o">{</span><span class="s2">&quot;code&quot;</span>:0,<span class="s2">&quot;msg&quot;</span>:<span class="s2">&quot;&quot;</span>,<span class="s2">&quot;data&quot;</span>:<span class="s2">&quot;token&quot;</span><span class="o">}</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/api-header-key&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;token: token&#39;</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="o">{</span><span class="s2">&quot;code&quot;</span>:0,<span class="s2">&quot;msg&quot;</span>:<span class="s2">&quot;&quot;</span>,<span class="s2">&quot;data&quot;</span>:<span class="s2">&quot;token&quot;</span><span class="o">}</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/api-query-key?token=token&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="o">{</span><span class="s2">&quot;code&quot;</span>:0,<span class="s2">&quot;msg&quot;</span>:<span class="s2">&quot;&quot;</span>,<span class="s2">&quot;data&quot;</span>:<span class="s2">&quot;token&quot;</span><span class="o">}</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="c1"># Fail Result</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/api-cookie-key&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Cookie: token=&#39;</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>Not<span class="w"> </span>authenticated
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/api-header-key&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;token: &#39;</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>Not<span class="w"> </span>authenticated
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/api-query-key?token=&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>Not<span class="w"> </span>authenticated
</code></pre></div></p>
<h3 id="11combination-of-apikey-and-links">1.1.Combination of APIKey and Links</h3>
<p>Most of the parameters (e.g., Token) needed by route functions that use APIKey are obtained through other route functions.
In this case, you can describe the relationship between this route function and other route functions by using <code>Links</code> in <code>Field</code>,
such as the following scenario, which gets its Token from the login route function:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:4"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><input id="__tabbed_2_3" name="__tabbed_2" type="radio" /><input id="__tabbed_2_4" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Flask</label><label for="__tabbed_2_2">Starlette</label><label for="__tabbed_2_3">Sanic</label><label for="__tabbed_2_4">Tornado</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/flask_with_apikey_and_link_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span>
<span class="normal"><a href="#__codelineno-5-34">34</a></span>
<span class="normal"><a href="#__codelineno-5-35">35</a></span>
<span class="normal"><a href="#__codelineno-5-36">36</a></span>
<span class="normal"><a href="#__codelineno-5-37">37</a></span>
<span class="normal"><a href="#__codelineno-5-38">38</a></span>
<span class="normal"><a href="#__codelineno-5-39">39</a></span>
<span class="normal"><a href="#__codelineno-5-40">40</a></span>
<span class="normal"><a href="#__codelineno-5-41">41</a></span>
<span class="normal"><a href="#__codelineno-5-42">42</a></span>
<span class="normal"><a href="#__codelineno-5-43">43</a></span>
<span class="normal"><a href="#__codelineno-5-44">44</a></span>
<span class="normal"><a href="#__codelineno-5-45">45</a></span>
<span class="normal"><a href="#__codelineno-5-46">46</a></span>
<span class="normal"><a href="#__codelineno-5-47">47</a></span>
<span class="normal"><a href="#__codelineno-5-48">48</a></span>
<span class="normal"><a href="#__codelineno-5-49">49</a></span>
<span class="normal"><a href="#__codelineno-5-50">50</a></span>
<span class="normal"><a href="#__codelineno-5-51">51</a></span>
<span class="normal"><a href="#__codelineno-5-52">52</a></span>
<span class="normal"><a href="#__codelineno-5-53">53</a></span>
<span class="normal"><a href="#__codelineno-5-54">54</a></span>
<span class="normal"><a href="#__codelineno-5-55">55</a></span>
<span class="normal"><a href="#__codelineno-5-56">56</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">import</span> <span class="nn">hashlib</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="kn">from</span> <span class="nn">pait.app.flask</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="kn">from</span> <span class="nn">pait.app.flask.security</span> <span class="kn">import</span> <span class="n">api_key</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Json</span><span class="p">,</span> <span class="n">Query</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="kn">from</span> <span class="nn">pait.model.response</span> <span class="kn">import</span> <span class="n">JsonResponseModel</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="kn">from</span> <span class="nn">pait.openapi.openapi</span> <span class="kn">import</span> <span class="n">LinksModel</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="hll"><span class="k">class</span> <span class="nc">LoginRespModel</span><span class="p">(</span><span class="n">JsonResponseModel</span><span class="p">):</span>
</span><a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="hll">    <span class="k">class</span> <span class="nc">ResponseModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><a id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="hll">        <span class="k">class</span> <span class="nc">DataModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="hll">            <span class="n">token</span><span class="p">:</span> <span class="nb">str</span>
</span><a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="hll">
</span><a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="hll">        <span class="n">code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;api code&quot;</span><span class="p">)</span>
</span><a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="hll">        <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;api status msg&quot;</span><span class="p">)</span>
</span><a id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="hll">        <span class="n">data</span><span class="p">:</span> <span class="n">DataModel</span>
</span><a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="hll">
</span><a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="hll">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;login response&quot;</span>
</span><a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="hll">    <span class="n">response_data</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResponseModel</span>
</span><a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="hll">
</span><a id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="hll">
</span><a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="hll"><span class="nd">@pait</span><span class="p">(</span><span class="n">response_model_list</span><span class="o">=</span><span class="p">[</span><span class="n">LoginRespModel</span><span class="p">])</span>
</span><a id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="hll"><span class="k">def</span> <span class="nf">login_route</span><span class="p">(</span><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;user id&quot;</span><span class="p">),</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="hll">    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">((</span><span class="n">uid</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()}}</span>
</span><a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="hll">
</span><a id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="hll">
</span><a id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="hll"><span class="n">link_login_token_model</span><span class="p">:</span> <span class="n">LinksModel</span> <span class="o">=</span> <span class="n">LinksModel</span><span class="p">(</span><span class="n">LoginRespModel</span><span class="p">,</span> <span class="s2">&quot;$response.body#/data/token&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;test links model&quot;</span><span class="p">)</span>
</span><a id="__codelineno-5-34" name="__codelineno-5-34"></a>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="n">token_query_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="n">links</span><span class="o">=</span><span class="n">link_login_token_model</span><span class="p">),</span>
</span><a id="__codelineno-5-39" name="__codelineno-5-39"></a>    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a>    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-query-api-key&quot;</span><span class="p">,</span>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="p">)</span>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="k">def</span> <span class="nf">api_key_query_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_query_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-5-46" name="__codelineno-5-46"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">}</span>
<a id="__codelineno-5-47" name="__codelineno-5-47"></a>
<a id="__codelineno-5-48" name="__codelineno-5-48"></a>
<a id="__codelineno-5-49" name="__codelineno-5-49"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">)</span>
<a id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/login&quot;</span><span class="p">,</span> <span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="n">login_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<a id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/api-query-key&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">api_key_query_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-5-52" name="__codelineno-5-52"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-5-53" name="__codelineno-5-53"></a>
<a id="__codelineno-5-54" name="__codelineno-5-54"></a>
<a id="__codelineno-5-55" name="__codelineno-5-55"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-5-56" name="__codelineno-5-56"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/starlette_with_apikey_and_link_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span>
<span class="normal"><a href="#__codelineno-6-31">31</a></span>
<span class="normal"><a href="#__codelineno-6-32">32</a></span>
<span class="normal"><a href="#__codelineno-6-33">33</a></span>
<span class="normal"><a href="#__codelineno-6-34">34</a></span>
<span class="normal"><a href="#__codelineno-6-35">35</a></span>
<span class="normal"><a href="#__codelineno-6-36">36</a></span>
<span class="normal"><a href="#__codelineno-6-37">37</a></span>
<span class="normal"><a href="#__codelineno-6-38">38</a></span>
<span class="normal"><a href="#__codelineno-6-39">39</a></span>
<span class="normal"><a href="#__codelineno-6-40">40</a></span>
<span class="normal"><a href="#__codelineno-6-41">41</a></span>
<span class="normal"><a href="#__codelineno-6-42">42</a></span>
<span class="normal"><a href="#__codelineno-6-43">43</a></span>
<span class="normal"><a href="#__codelineno-6-44">44</a></span>
<span class="normal"><a href="#__codelineno-6-45">45</a></span>
<span class="normal"><a href="#__codelineno-6-46">46</a></span>
<span class="normal"><a href="#__codelineno-6-47">47</a></span>
<span class="normal"><a href="#__codelineno-6-48">48</a></span>
<span class="normal"><a href="#__codelineno-6-49">49</a></span>
<span class="normal"><a href="#__codelineno-6-50">50</a></span>
<span class="normal"><a href="#__codelineno-6-51">51</a></span>
<span class="normal"><a href="#__codelineno-6-52">52</a></span>
<span class="normal"><a href="#__codelineno-6-53">53</a></span>
<span class="normal"><a href="#__codelineno-6-54">54</a></span>
<span class="normal"><a href="#__codelineno-6-55">55</a></span>
<span class="normal"><a href="#__codelineno-6-56">56</a></span>
<span class="normal"><a href="#__codelineno-6-57">57</a></span>
<span class="normal"><a href="#__codelineno-6-58">58</a></span>
<span class="normal"><a href="#__codelineno-6-59">59</a></span>
<span class="normal"><a href="#__codelineno-6-60">60</a></span>
<span class="normal"><a href="#__codelineno-6-61">61</a></span>
<span class="normal"><a href="#__codelineno-6-62">62</a></span>
<span class="normal"><a href="#__codelineno-6-63">63</a></span>
<span class="normal"><a href="#__codelineno-6-64">64</a></span>
<span class="normal"><a href="#__codelineno-6-65">65</a></span>
<span class="normal"><a href="#__codelineno-6-66">66</a></span>
<span class="normal"><a href="#__codelineno-6-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">import</span> <span class="nn">hashlib</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kn">from</span> <span class="nn">starlette.applications</span> <span class="kn">import</span> <span class="n">Starlette</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="kn">from</span> <span class="nn">starlette.responses</span> <span class="kn">import</span> <span class="n">JSONResponse</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="kn">from</span> <span class="nn">starlette.routing</span> <span class="kn">import</span> <span class="n">Route</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="kn">from</span> <span class="nn">pait.app.starlette</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="kn">from</span> <span class="nn">pait.app.starlette.security</span> <span class="kn">import</span> <span class="n">api_key</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Json</span><span class="p">,</span> <span class="n">Query</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="kn">from</span> <span class="nn">pait.model.response</span> <span class="kn">import</span> <span class="n">JsonResponseModel</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="kn">from</span> <span class="nn">pait.openapi.openapi</span> <span class="kn">import</span> <span class="n">LinksModel</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="hll"><span class="k">class</span> <span class="nc">LoginRespModel</span><span class="p">(</span><span class="n">JsonResponseModel</span><span class="p">):</span>
</span><a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="hll">    <span class="k">class</span> <span class="nc">ResponseModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="hll">        <span class="k">class</span> <span class="nc">DataModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="hll">            <span class="n">token</span><span class="p">:</span> <span class="nb">str</span>
</span><a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="hll">
</span><a id="__codelineno-6-22" name="__codelineno-6-22"></a><span class="hll">        <span class="n">code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;api code&quot;</span><span class="p">)</span>
</span><a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="hll">        <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;api status msg&quot;</span><span class="p">)</span>
</span><a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="hll">        <span class="n">data</span><span class="p">:</span> <span class="n">DataModel</span>
</span><a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="hll">
</span><a id="__codelineno-6-26" name="__codelineno-6-26"></a><span class="hll">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;login response&quot;</span>
</span><a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="hll">    <span class="n">response_data</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResponseModel</span>
</span><a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="hll">
</span><a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="hll">
</span><a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="hll"><span class="nd">@pait</span><span class="p">(</span><span class="n">response_model_list</span><span class="o">=</span><span class="p">[</span><span class="n">LoginRespModel</span><span class="p">])</span>
</span><a id="__codelineno-6-31" name="__codelineno-6-31"></a><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">login_route</span><span class="p">(</span>
</span><a id="__codelineno-6-32" name="__codelineno-6-32"></a><span class="hll">    <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;user id&quot;</span><span class="p">),</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
</span><a id="__codelineno-6-33" name="__codelineno-6-33"></a><span class="hll"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><a id="__codelineno-6-34" name="__codelineno-6-34"></a><span class="hll">    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span>
</span><a id="__codelineno-6-35" name="__codelineno-6-35"></a><span class="hll">        <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">((</span><span class="n">uid</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()}}</span>
</span><a id="__codelineno-6-36" name="__codelineno-6-36"></a><span class="hll">    <span class="p">)</span>
</span><a id="__codelineno-6-37" name="__codelineno-6-37"></a><span class="hll">
</span><a id="__codelineno-6-38" name="__codelineno-6-38"></a><span class="hll">
</span><a id="__codelineno-6-39" name="__codelineno-6-39"></a><span class="hll"><span class="n">link_login_token_model</span><span class="p">:</span> <span class="n">LinksModel</span> <span class="o">=</span> <span class="n">LinksModel</span><span class="p">(</span><span class="n">LoginRespModel</span><span class="p">,</span> <span class="s2">&quot;$response.body#/data/token&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;test links model&quot;</span><span class="p">)</span>
</span><a id="__codelineno-6-40" name="__codelineno-6-40"></a>
<a id="__codelineno-6-41" name="__codelineno-6-41"></a>
<a id="__codelineno-6-42" name="__codelineno-6-42"></a><span class="n">token_query_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
<a id="__codelineno-6-43" name="__codelineno-6-43"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
<a id="__codelineno-6-44" name="__codelineno-6-44"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="n">links</span><span class="o">=</span><span class="n">link_login_token_model</span><span class="p">),</span>
</span><a id="__codelineno-6-45" name="__codelineno-6-45"></a>    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-6-46" name="__codelineno-6-46"></a>    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-query-api-key&quot;</span><span class="p">,</span>
<a id="__codelineno-6-47" name="__codelineno-6-47"></a><span class="p">)</span>
<a id="__codelineno-6-48" name="__codelineno-6-48"></a>
<a id="__codelineno-6-49" name="__codelineno-6-49"></a>
<a id="__codelineno-6-50" name="__codelineno-6-50"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-6-51" name="__codelineno-6-51"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">api_key_query_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_query_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
<a id="__codelineno-6-52" name="__codelineno-6-52"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
<a id="__codelineno-6-53" name="__codelineno-6-53"></a>
<a id="__codelineno-6-54" name="__codelineno-6-54"></a>
<a id="__codelineno-6-55" name="__codelineno-6-55"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Starlette</span><span class="p">(</span>
<a id="__codelineno-6-56" name="__codelineno-6-56"></a>    <span class="n">routes</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-6-57" name="__codelineno-6-57"></a>        <span class="n">Route</span><span class="p">(</span><span class="s2">&quot;/api/login&quot;</span><span class="p">,</span> <span class="n">login_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">]),</span>
<a id="__codelineno-6-58" name="__codelineno-6-58"></a>        <span class="n">Route</span><span class="p">(</span><span class="s2">&quot;/api/api-query-key&quot;</span><span class="p">,</span> <span class="n">api_key_query_route</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">]),</span>
<a id="__codelineno-6-59" name="__codelineno-6-59"></a>    <span class="p">]</span>
<a id="__codelineno-6-60" name="__codelineno-6-60"></a><span class="p">)</span>
<a id="__codelineno-6-61" name="__codelineno-6-61"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-6-62" name="__codelineno-6-62"></a>
<a id="__codelineno-6-63" name="__codelineno-6-63"></a>
<a id="__codelineno-6-64" name="__codelineno-6-64"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-6-65" name="__codelineno-6-65"></a>    <span class="kn">import</span> <span class="nn">uvicorn</span>
<a id="__codelineno-6-66" name="__codelineno-6-66"></a>
<a id="__codelineno-6-67" name="__codelineno-6-67"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/sanic_with_apikey_and_link_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span>
<span class="normal"><a href="#__codelineno-7-37">37</a></span>
<span class="normal"><a href="#__codelineno-7-38">38</a></span>
<span class="normal"><a href="#__codelineno-7-39">39</a></span>
<span class="normal"><a href="#__codelineno-7-40">40</a></span>
<span class="normal"><a href="#__codelineno-7-41">41</a></span>
<span class="normal"><a href="#__codelineno-7-42">42</a></span>
<span class="normal"><a href="#__codelineno-7-43">43</a></span>
<span class="normal"><a href="#__codelineno-7-44">44</a></span>
<span class="normal"><a href="#__codelineno-7-45">45</a></span>
<span class="normal"><a href="#__codelineno-7-46">46</a></span>
<span class="normal"><a href="#__codelineno-7-47">47</a></span>
<span class="normal"><a href="#__codelineno-7-48">48</a></span>
<span class="normal"><a href="#__codelineno-7-49">49</a></span>
<span class="normal"><a href="#__codelineno-7-50">50</a></span>
<span class="normal"><a href="#__codelineno-7-51">51</a></span>
<span class="normal"><a href="#__codelineno-7-52">52</a></span>
<span class="normal"><a href="#__codelineno-7-53">53</a></span>
<span class="normal"><a href="#__codelineno-7-54">54</a></span>
<span class="normal"><a href="#__codelineno-7-55">55</a></span>
<span class="normal"><a href="#__codelineno-7-56">56</a></span>
<span class="normal"><a href="#__codelineno-7-57">57</a></span>
<span class="normal"><a href="#__codelineno-7-58">58</a></span>
<span class="normal"><a href="#__codelineno-7-59">59</a></span>
<span class="normal"><a href="#__codelineno-7-60">60</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="kn">import</span> <span class="nn">hashlib</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">HTTPResponse</span><span class="p">,</span> <span class="n">Sanic</span><span class="p">,</span> <span class="n">json</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="kn">from</span> <span class="nn">pait.app.sanic</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="kn">from</span> <span class="nn">pait.app.sanic.security</span> <span class="kn">import</span> <span class="n">api_key</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Json</span><span class="p">,</span> <span class="n">Query</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="kn">from</span> <span class="nn">pait.model.response</span> <span class="kn">import</span> <span class="n">JsonResponseModel</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="kn">from</span> <span class="nn">pait.openapi.openapi</span> <span class="kn">import</span> <span class="n">LinksModel</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="hll"><span class="k">class</span> <span class="nc">LoginRespModel</span><span class="p">(</span><span class="n">JsonResponseModel</span><span class="p">):</span>
</span><a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="hll">    <span class="k">class</span> <span class="nc">ResponseModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="hll">        <span class="k">class</span> <span class="nc">DataModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="hll">            <span class="n">token</span><span class="p">:</span> <span class="nb">str</span>
</span><a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="hll">
</span><a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="hll">        <span class="n">code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;api code&quot;</span><span class="p">)</span>
</span><a id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="hll">        <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;api status msg&quot;</span><span class="p">)</span>
</span><a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="hll">        <span class="n">data</span><span class="p">:</span> <span class="n">DataModel</span>
</span><a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="hll">
</span><a id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="hll">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;login response&quot;</span>
</span><a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="hll">    <span class="n">response_data</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResponseModel</span>
</span><a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="hll">
</span><a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="hll">
</span><a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="hll"><span class="nd">@pait</span><span class="p">(</span><span class="n">response_model_list</span><span class="o">=</span><span class="p">[</span><span class="n">LoginRespModel</span><span class="p">])</span>
</span><a id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">login_route</span><span class="p">(</span>
</span><a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="hll">    <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;user id&quot;</span><span class="p">),</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
</span><a id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="hll"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HTTPResponse</span><span class="p">:</span>
</span><a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="hll">    <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">((</span><span class="n">uid</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()}})</span>
</span><a id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="hll">
</span><a id="__codelineno-7-34" name="__codelineno-7-34"></a><span class="hll">
</span><a id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="hll"><span class="n">link_login_token_model</span><span class="p">:</span> <span class="n">LinksModel</span> <span class="o">=</span> <span class="n">LinksModel</span><span class="p">(</span><span class="n">LoginRespModel</span><span class="p">,</span> <span class="s2">&quot;$response.body#/data/token&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;test links model&quot;</span><span class="p">)</span>
</span><a id="__codelineno-7-36" name="__codelineno-7-36"></a>
<a id="__codelineno-7-37" name="__codelineno-7-37"></a>
<a id="__codelineno-7-38" name="__codelineno-7-38"></a><span class="n">token_query_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
<a id="__codelineno-7-39" name="__codelineno-7-39"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
<a id="__codelineno-7-40" name="__codelineno-7-40"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="n">links</span><span class="o">=</span><span class="n">link_login_token_model</span><span class="p">),</span>
</span><a id="__codelineno-7-41" name="__codelineno-7-41"></a>    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-7-42" name="__codelineno-7-42"></a>    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-query-api-key&quot;</span><span class="p">,</span>
<a id="__codelineno-7-43" name="__codelineno-7-43"></a><span class="p">)</span>
<a id="__codelineno-7-44" name="__codelineno-7-44"></a>
<a id="__codelineno-7-45" name="__codelineno-7-45"></a>
<a id="__codelineno-7-46" name="__codelineno-7-46"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-7-47" name="__codelineno-7-47"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">api_key_query_route</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_query_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">HTTPResponse</span><span class="p">:</span>
<a id="__codelineno-7-48" name="__codelineno-7-48"></a>    <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
<a id="__codelineno-7-49" name="__codelineno-7-49"></a>
<a id="__codelineno-7-50" name="__codelineno-7-50"></a>
<a id="__codelineno-7-51" name="__codelineno-7-51"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;demo&quot;</span><span class="p">)</span>
<a id="__codelineno-7-52" name="__codelineno-7-52"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">login_route</span><span class="p">,</span> <span class="s2">&quot;/api/login&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<a id="__codelineno-7-53" name="__codelineno-7-53"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">api_key_query_route</span><span class="p">,</span> <span class="s2">&quot;/api/api-query-key&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-7-54" name="__codelineno-7-54"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-7-55" name="__codelineno-7-55"></a>
<a id="__codelineno-7-56" name="__codelineno-7-56"></a>
<a id="__codelineno-7-57" name="__codelineno-7-57"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-7-58" name="__codelineno-7-58"></a>    <span class="kn">import</span> <span class="nn">uvicorn</span>
<a id="__codelineno-7-59" name="__codelineno-7-59"></a>
<a id="__codelineno-7-60" name="__codelineno-7-60"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/tornado_with_apikey_and_link_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span>
<span class="normal"><a href="#__codelineno-8-33">33</a></span>
<span class="normal"><a href="#__codelineno-8-34">34</a></span>
<span class="normal"><a href="#__codelineno-8-35">35</a></span>
<span class="normal"><a href="#__codelineno-8-36">36</a></span>
<span class="normal"><a href="#__codelineno-8-37">37</a></span>
<span class="normal"><a href="#__codelineno-8-38">38</a></span>
<span class="normal"><a href="#__codelineno-8-39">39</a></span>
<span class="normal"><a href="#__codelineno-8-40">40</a></span>
<span class="normal"><a href="#__codelineno-8-41">41</a></span>
<span class="normal"><a href="#__codelineno-8-42">42</a></span>
<span class="normal"><a href="#__codelineno-8-43">43</a></span>
<span class="normal"><a href="#__codelineno-8-44">44</a></span>
<span class="normal"><a href="#__codelineno-8-45">45</a></span>
<span class="normal"><a href="#__codelineno-8-46">46</a></span>
<span class="normal"><a href="#__codelineno-8-47">47</a></span>
<span class="normal"><a href="#__codelineno-8-48">48</a></span>
<span class="normal"><a href="#__codelineno-8-49">49</a></span>
<span class="normal"><a href="#__codelineno-8-50">50</a></span>
<span class="normal"><a href="#__codelineno-8-51">51</a></span>
<span class="normal"><a href="#__codelineno-8-52">52</a></span>
<span class="normal"><a href="#__codelineno-8-53">53</a></span>
<span class="normal"><a href="#__codelineno-8-54">54</a></span>
<span class="normal"><a href="#__codelineno-8-55">55</a></span>
<span class="normal"><a href="#__codelineno-8-56">56</a></span>
<span class="normal"><a href="#__codelineno-8-57">57</a></span>
<span class="normal"><a href="#__codelineno-8-58">58</a></span>
<span class="normal"><a href="#__codelineno-8-59">59</a></span>
<span class="normal"><a href="#__codelineno-8-60">60</a></span>
<span class="normal"><a href="#__codelineno-8-61">61</a></span>
<span class="normal"><a href="#__codelineno-8-62">62</a></span>
<span class="normal"><a href="#__codelineno-8-63">63</a></span>
<span class="normal"><a href="#__codelineno-8-64">64</a></span>
<span class="normal"><a href="#__codelineno-8-65">65</a></span>
<span class="normal"><a href="#__codelineno-8-66">66</a></span>
<span class="normal"><a href="#__codelineno-8-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kn">import</span> <span class="nn">hashlib</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="kn">import</span> <span class="n">IOLoop</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="kn">from</span> <span class="nn">tornado.web</span> <span class="kn">import</span> <span class="n">Application</span><span class="p">,</span> <span class="n">RequestHandler</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="kn">from</span> <span class="nn">pait.app.tornado</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="kn">from</span> <span class="nn">pait.app.tornado.security</span> <span class="kn">import</span> <span class="n">api_key</span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span><span class="p">,</span> <span class="n">Json</span><span class="p">,</span> <span class="n">Query</span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="kn">from</span> <span class="nn">pait.model.response</span> <span class="kn">import</span> <span class="n">JsonResponseModel</span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="kn">from</span> <span class="nn">pait.openapi.openapi</span> <span class="kn">import</span> <span class="n">LinksModel</span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="hll"><span class="k">class</span> <span class="nc">LoginRespModel</span><span class="p">(</span><span class="n">JsonResponseModel</span><span class="p">):</span>
</span><a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="hll">    <span class="k">class</span> <span class="nc">ResponseModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="hll">        <span class="k">class</span> <span class="nc">DataModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="hll">            <span class="n">token</span><span class="p">:</span> <span class="nb">str</span>
</span><a id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="hll">
</span><a id="__codelineno-8-21" name="__codelineno-8-21"></a><span class="hll">        <span class="n">code</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;api code&quot;</span><span class="p">)</span>
</span><a id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="hll">        <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;api status msg&quot;</span><span class="p">)</span>
</span><a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="hll">        <span class="n">data</span><span class="p">:</span> <span class="n">DataModel</span>
</span><a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="hll">
</span><a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="hll">    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;login response&quot;</span>
</span><a id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="hll">    <span class="n">response_data</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">ResponseModel</span>
</span><a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="hll">
</span><a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="hll">
</span><a id="__codelineno-8-29" name="__codelineno-8-29"></a><span class="hll"><span class="k">class</span> <span class="nc">LoginHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
</span><a id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="hll">    <span class="nd">@pait</span><span class="p">(</span><span class="n">response_model_list</span><span class="o">=</span><span class="p">[</span><span class="n">LoginRespModel</span><span class="p">])</span>
</span><a id="__codelineno-8-31" name="__codelineno-8-31"></a><span class="hll">    <span class="k">async</span> <span class="k">def</span> <span class="nf">post</span><span class="p">(</span>
</span><a id="__codelineno-8-32" name="__codelineno-8-32"></a><span class="hll">        <span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;user id&quot;</span><span class="p">),</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Json</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
</span><a id="__codelineno-8-33" name="__codelineno-8-33"></a><span class="hll">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><a id="__codelineno-8-34" name="__codelineno-8-34"></a><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
</span><a id="__codelineno-8-35" name="__codelineno-8-35"></a><span class="hll">            <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;token&quot;</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">((</span><span class="n">uid</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()}}</span>
</span><a id="__codelineno-8-36" name="__codelineno-8-36"></a><span class="hll">        <span class="p">)</span>
</span><a id="__codelineno-8-37" name="__codelineno-8-37"></a><span class="hll">
</span><a id="__codelineno-8-38" name="__codelineno-8-38"></a><span class="hll">
</span><a id="__codelineno-8-39" name="__codelineno-8-39"></a><span class="hll"><span class="n">link_login_token_model</span><span class="p">:</span> <span class="n">LinksModel</span> <span class="o">=</span> <span class="n">LinksModel</span><span class="p">(</span><span class="n">LoginRespModel</span><span class="p">,</span> <span class="s2">&quot;$response.body#/data/token&quot;</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;test links model&quot;</span><span class="p">)</span>
</span><a id="__codelineno-8-40" name="__codelineno-8-40"></a>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a><span class="n">token_query_api_key</span><span class="p">:</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span> <span class="o">=</span> <span class="n">api_key</span><span class="o">.</span><span class="n">APIKey</span><span class="p">(</span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;token&quot;</span><span class="p">,</span>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a><span class="hll">    <span class="n">field</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="n">links</span><span class="o">=</span><span class="n">link_login_token_model</span><span class="p">),</span>
</span><a id="__codelineno-8-45" name="__codelineno-8-45"></a>    <span class="n">verify_api_key_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;token&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span>
<a id="__codelineno-8-46" name="__codelineno-8-46"></a>    <span class="n">security_name</span><span class="o">=</span><span class="s2">&quot;token-query-api-key&quot;</span><span class="p">,</span>
<a id="__codelineno-8-47" name="__codelineno-8-47"></a><span class="p">)</span>
<a id="__codelineno-8-48" name="__codelineno-8-48"></a>
<a id="__codelineno-8-49" name="__codelineno-8-49"></a>
<a id="__codelineno-8-50" name="__codelineno-8-50"></a><span class="k">class</span> <span class="nc">APIKeyQueryHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
<a id="__codelineno-8-51" name="__codelineno-8-51"></a>    <span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-8-52" name="__codelineno-8-52"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">token_query_api_key</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-8-53" name="__codelineno-8-53"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">token</span><span class="p">})</span>
<a id="__codelineno-8-54" name="__codelineno-8-54"></a>
<a id="__codelineno-8-55" name="__codelineno-8-55"></a>
<a id="__codelineno-8-56" name="__codelineno-8-56"></a><span class="n">app</span><span class="p">:</span> <span class="n">Application</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span>
<a id="__codelineno-8-57" name="__codelineno-8-57"></a>    <span class="p">[</span>
<a id="__codelineno-8-58" name="__codelineno-8-58"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/login&quot;</span><span class="p">,</span> <span class="n">LoginHandler</span><span class="p">),</span>
<a id="__codelineno-8-59" name="__codelineno-8-59"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/api-query-key&quot;</span><span class="p">,</span> <span class="n">APIKeyQueryHandler</span><span class="p">),</span>
<a id="__codelineno-8-60" name="__codelineno-8-60"></a>    <span class="p">],</span>
<a id="__codelineno-8-61" name="__codelineno-8-61"></a><span class="p">)</span>
<a id="__codelineno-8-62" name="__codelineno-8-62"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-8-63" name="__codelineno-8-63"></a>
<a id="__codelineno-8-64" name="__codelineno-8-64"></a>
<a id="__codelineno-8-65" name="__codelineno-8-65"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-8-66" name="__codelineno-8-66"></a>    <span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>
<a id="__codelineno-8-67" name="__codelineno-8-67"></a>    <span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>The first highlighted code is from <a href="/3_1_openapi/#41links">Field-Links</a>, while the <code>Query</code> in the second highlighted code sets the <code>links</code> attribute to <code>link_login_token_model</code>.
This way <code>Pait</code> will bind <code>login_route</code> to <code>api_key_query_route</code> via Link when generating OpenAPI.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>openapi_include=False</code> causes <code>Swggaer</code> to be unable to display Link data.</p>
</div>
<h2 id="2http">2.HTTP</h2>
<p>There are two types of HTTP basic authentication, one is <code>HTTPBasic</code> and the other is <code>HTTPBearer</code> or <code>HTTPDIgest</code>.
The difference between the two is that <code>HTTPBasic</code> needs to verify the <code>username</code> and <code>password</code> parameters in the request header,
and if the verification is successful, it means the authentication is successful.
If the validation error will return <code>401</code> response, the browser will pop up a window to let the user enter <code>username</code> and <code>password</code>.
While <code>HTTPBearer</code> or <code>HTTPDIgest</code> only need to pass <code>token</code> in the request header as required.</p>
<p><code>Pait</code> encapsulates the <code>HTTPBasic</code>, <code>HTTPBearer</code> and <code>HTTPDigest</code> classes for each of the three methods of HTTP basic authentication.
Like <code>APIKey</code> they need to be bound to a route function via <code>Depend</code>, which is used as follows:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:4"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><input id="__tabbed_3_3" name="__tabbed_3" type="radio" /><input id="__tabbed_3_4" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Flask</label><label for="__tabbed_3_2">Starlette</label><label for="__tabbed_3_3">Sanic</label><label for="__tabbed_3_4">Tornado</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/flask_with_http_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span>
<span class="normal"><a href="#__codelineno-9-24">24</a></span>
<span class="normal"><a href="#__codelineno-9-25">25</a></span>
<span class="normal"><a href="#__codelineno-9-26">26</a></span>
<span class="normal"><a href="#__codelineno-9-27">27</a></span>
<span class="normal"><a href="#__codelineno-9-28">28</a></span>
<span class="normal"><a href="#__codelineno-9-29">29</a></span>
<span class="normal"><a href="#__codelineno-9-30">30</a></span>
<span class="normal"><a href="#__codelineno-9-31">31</a></span>
<span class="normal"><a href="#__codelineno-9-32">32</a></span>
<span class="normal"><a href="#__codelineno-9-33">33</a></span>
<span class="normal"><a href="#__codelineno-9-34">34</a></span>
<span class="normal"><a href="#__codelineno-9-35">35</a></span>
<span class="normal"><a href="#__codelineno-9-36">36</a></span>
<span class="normal"><a href="#__codelineno-9-37">37</a></span>
<span class="normal"><a href="#__codelineno-9-38">38</a></span>
<span class="normal"><a href="#__codelineno-9-39">39</a></span>
<span class="normal"><a href="#__codelineno-9-40">40</a></span>
<span class="normal"><a href="#__codelineno-9-41">41</a></span>
<span class="normal"><a href="#__codelineno-9-42">42</a></span>
<span class="normal"><a href="#__codelineno-9-43">43</a></span>
<span class="normal"><a href="#__codelineno-9-44">44</a></span>
<span class="normal"><a href="#__codelineno-9-45">45</a></span>
<span class="normal"><a href="#__codelineno-9-46">46</a></span>
<span class="normal"><a href="#__codelineno-9-47">47</a></span>
<span class="normal"><a href="#__codelineno-9-48">48</a></span>
<span class="normal"><a href="#__codelineno-9-49">49</a></span>
<span class="normal"><a href="#__codelineno-9-50">50</a></span>
<span class="normal"><a href="#__codelineno-9-51">51</a></span>
<span class="normal"><a href="#__codelineno-9-52">52</a></span>
<span class="normal"><a href="#__codelineno-9-53">53</a></span>
<span class="normal"><a href="#__codelineno-9-54">54</a></span>
<span class="normal"><a href="#__codelineno-9-55">55</a></span>
<span class="normal"><a href="#__codelineno-9-56">56</a></span>
<span class="normal"><a href="#__codelineno-9-57">57</a></span>
<span class="normal"><a href="#__codelineno-9-58">58</a></span>
<span class="normal"><a href="#__codelineno-9-59">59</a></span>
<span class="normal"><a href="#__codelineno-9-60">60</a></span>
<span class="normal"><a href="#__codelineno-9-61">61</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="kn">from</span> <span class="nn">pait.app.flask</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="kn">from</span> <span class="nn">pait.app.flask.security</span> <span class="kn">import</span> <span class="n">http</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="c1">##############</span>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="c1"># HTTP Basic #</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="c1">##############</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="n">http_basic</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBasic</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBasic</span><span class="p">()</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a>
<a id="__codelineno-9-15" name="__codelineno-9-15"></a>
<a id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="k">def</span> <span class="nf">get_user_name</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">http</span><span class="o">.</span><span class="n">HTTPBasicCredentials</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">http_basic</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-9-17" name="__codelineno-9-17"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
<a id="__codelineno-9-18" name="__codelineno-9-18"></a>        <span class="k">raise</span> <span class="n">http_basic</span><span class="o">.</span><span class="n">not_authorization_exc</span>
<a id="__codelineno-9-19" name="__codelineno-9-19"></a>    <span class="k">return</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span>
<a id="__codelineno-9-20" name="__codelineno-9-20"></a>
<a id="__codelineno-9-21" name="__codelineno-9-21"></a>
<a id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="k">def</span> <span class="nf">get_user_name_by_http_basic_credentials</span><span class="p">(</span><span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_user_name</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-9-24" name="__codelineno-9-24"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_name</span><span class="p">}</span>
<a id="__codelineno-9-25" name="__codelineno-9-25"></a>
<a id="__codelineno-9-26" name="__codelineno-9-26"></a>
<a id="__codelineno-9-27" name="__codelineno-9-27"></a><span class="c1">#############</span>
<a id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="c1"># HTTP Bear #</span>
<a id="__codelineno-9-29" name="__codelineno-9-29"></a><span class="c1">#############</span>
<a id="__codelineno-9-30" name="__codelineno-9-30"></a><span class="n">http_bear</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBearer</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBearer</span><span class="p">(</span><span class="n">verify_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-9-31" name="__codelineno-9-31"></a>
<a id="__codelineno-9-32" name="__codelineno-9-32"></a>
<a id="__codelineno-9-33" name="__codelineno-9-33"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="k">def</span> <span class="nf">get_user_name_by_http_bearer</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">http_bear</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-9-35" name="__codelineno-9-35"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">}</span>
<a id="__codelineno-9-36" name="__codelineno-9-36"></a>
<a id="__codelineno-9-37" name="__codelineno-9-37"></a>
<a id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="c1">###############</span>
<a id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="c1"># HTTP Digest #</span>
<a id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="c1">###############</span>
<a id="__codelineno-9-41" name="__codelineno-9-41"></a><span class="n">http_digest</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPDigest</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPDigest</span><span class="p">(</span><span class="n">verify_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-9-42" name="__codelineno-9-42"></a>
<a id="__codelineno-9-43" name="__codelineno-9-43"></a>
<a id="__codelineno-9-44" name="__codelineno-9-44"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-9-45" name="__codelineno-9-45"></a><span class="k">def</span> <span class="nf">get_user_name_by_http_digest</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">http_digest</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-9-46" name="__codelineno-9-46"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">}</span>
<a id="__codelineno-9-47" name="__codelineno-9-47"></a>
<a id="__codelineno-9-48" name="__codelineno-9-48"></a>
<a id="__codelineno-9-49" name="__codelineno-9-49"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">)</span>
<a id="__codelineno-9-50" name="__codelineno-9-50"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span>
<a id="__codelineno-9-51" name="__codelineno-9-51"></a>    <span class="s2">&quot;/api/user-name-by-http-basic-credentials&quot;</span><span class="p">,</span>
<a id="__codelineno-9-52" name="__codelineno-9-52"></a>    <span class="n">view_func</span><span class="o">=</span><span class="n">get_user_name_by_http_basic_credentials</span><span class="p">,</span>
<a id="__codelineno-9-53" name="__codelineno-9-53"></a>    <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">],</span>
<a id="__codelineno-9-54" name="__codelineno-9-54"></a><span class="p">)</span>
<a id="__codelineno-9-55" name="__codelineno-9-55"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/user-name-by-http-bearer&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">get_user_name_by_http_bearer</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-9-56" name="__codelineno-9-56"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/user-name-by-http-digest&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">get_user_name_by_http_digest</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-9-57" name="__codelineno-9-57"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-9-58" name="__codelineno-9-58"></a>
<a id="__codelineno-9-59" name="__codelineno-9-59"></a>
<a id="__codelineno-9-60" name="__codelineno-9-60"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-9-61" name="__codelineno-9-61"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/starlette_with_http_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span>
<span class="normal"><a href="#__codelineno-10-31">31</a></span>
<span class="normal"><a href="#__codelineno-10-32">32</a></span>
<span class="normal"><a href="#__codelineno-10-33">33</a></span>
<span class="normal"><a href="#__codelineno-10-34">34</a></span>
<span class="normal"><a href="#__codelineno-10-35">35</a></span>
<span class="normal"><a href="#__codelineno-10-36">36</a></span>
<span class="normal"><a href="#__codelineno-10-37">37</a></span>
<span class="normal"><a href="#__codelineno-10-38">38</a></span>
<span class="normal"><a href="#__codelineno-10-39">39</a></span>
<span class="normal"><a href="#__codelineno-10-40">40</a></span>
<span class="normal"><a href="#__codelineno-10-41">41</a></span>
<span class="normal"><a href="#__codelineno-10-42">42</a></span>
<span class="normal"><a href="#__codelineno-10-43">43</a></span>
<span class="normal"><a href="#__codelineno-10-44">44</a></span>
<span class="normal"><a href="#__codelineno-10-45">45</a></span>
<span class="normal"><a href="#__codelineno-10-46">46</a></span>
<span class="normal"><a href="#__codelineno-10-47">47</a></span>
<span class="normal"><a href="#__codelineno-10-48">48</a></span>
<span class="normal"><a href="#__codelineno-10-49">49</a></span>
<span class="normal"><a href="#__codelineno-10-50">50</a></span>
<span class="normal"><a href="#__codelineno-10-51">51</a></span>
<span class="normal"><a href="#__codelineno-10-52">52</a></span>
<span class="normal"><a href="#__codelineno-10-53">53</a></span>
<span class="normal"><a href="#__codelineno-10-54">54</a></span>
<span class="normal"><a href="#__codelineno-10-55">55</a></span>
<span class="normal"><a href="#__codelineno-10-56">56</a></span>
<span class="normal"><a href="#__codelineno-10-57">57</a></span>
<span class="normal"><a href="#__codelineno-10-58">58</a></span>
<span class="normal"><a href="#__codelineno-10-59">59</a></span>
<span class="normal"><a href="#__codelineno-10-60">60</a></span>
<span class="normal"><a href="#__codelineno-10-61">61</a></span>
<span class="normal"><a href="#__codelineno-10-62">62</a></span>
<span class="normal"><a href="#__codelineno-10-63">63</a></span>
<span class="normal"><a href="#__codelineno-10-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="kn">from</span> <span class="nn">starlette.applications</span> <span class="kn">import</span> <span class="n">Starlette</span>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="kn">from</span> <span class="nn">starlette.responses</span> <span class="kn">import</span> <span class="n">JSONResponse</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="kn">from</span> <span class="nn">starlette.routing</span> <span class="kn">import</span> <span class="n">Route</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="kn">from</span> <span class="nn">pait.app.starlette</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="kn">from</span> <span class="nn">pait.app.starlette.security</span> <span class="kn">import</span> <span class="n">http</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="c1">##############</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="c1"># HTTP Basic #</span>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="c1">##############</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="n">http_basic</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBasic</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBasic</span><span class="p">()</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="k">def</span> <span class="nf">get_user_name</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">http</span><span class="o">.</span><span class="n">HTTPBasicCredentials</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">http_basic</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a>        <span class="k">raise</span> <span class="n">http_basic</span><span class="o">.</span><span class="n">not_authorization_exc</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a>    <span class="k">return</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user_name_by_http_basic_credentials</span><span class="p">(</span><span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_user_name</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_name</span><span class="p">})</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="c1">#############</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="c1"># HTTP Bear #</span>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="c1">#############</span>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="n">http_bear</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBearer</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBearer</span><span class="p">(</span><span class="n">verify_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-10-33" name="__codelineno-10-33"></a>
<a id="__codelineno-10-34" name="__codelineno-10-34"></a>
<a id="__codelineno-10-35" name="__codelineno-10-35"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user_name_by_http_bearer</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">http_bear</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
<a id="__codelineno-10-37" name="__codelineno-10-37"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">})</span>
<a id="__codelineno-10-38" name="__codelineno-10-38"></a>
<a id="__codelineno-10-39" name="__codelineno-10-39"></a>
<a id="__codelineno-10-40" name="__codelineno-10-40"></a><span class="c1">###############</span>
<a id="__codelineno-10-41" name="__codelineno-10-41"></a><span class="c1"># HTTP Digest #</span>
<a id="__codelineno-10-42" name="__codelineno-10-42"></a><span class="c1">###############</span>
<a id="__codelineno-10-43" name="__codelineno-10-43"></a><span class="n">http_digest</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPDigest</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPDigest</span><span class="p">(</span><span class="n">verify_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-10-44" name="__codelineno-10-44"></a>
<a id="__codelineno-10-45" name="__codelineno-10-45"></a>
<a id="__codelineno-10-46" name="__codelineno-10-46"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-10-47" name="__codelineno-10-47"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user_name_by_http_digest</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">http_digest</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
<a id="__codelineno-10-48" name="__codelineno-10-48"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">})</span>
<a id="__codelineno-10-49" name="__codelineno-10-49"></a>
<a id="__codelineno-10-50" name="__codelineno-10-50"></a>
<a id="__codelineno-10-51" name="__codelineno-10-51"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Starlette</span><span class="p">(</span>
<a id="__codelineno-10-52" name="__codelineno-10-52"></a>    <span class="n">routes</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-10-53" name="__codelineno-10-53"></a>        <span class="n">Route</span><span class="p">(</span><span class="s2">&quot;/api/user-name-by-http-basic-credentials&quot;</span><span class="p">,</span> <span class="n">get_user_name_by_http_basic_credentials</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">]),</span>
<a id="__codelineno-10-54" name="__codelineno-10-54"></a>        <span class="n">Route</span><span class="p">(</span><span class="s2">&quot;/api/user-name-by-http-bearer&quot;</span><span class="p">,</span> <span class="n">get_user_name_by_http_bearer</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">]),</span>
<a id="__codelineno-10-55" name="__codelineno-10-55"></a>        <span class="n">Route</span><span class="p">(</span><span class="s2">&quot;/api/user-name-by-http-digest&quot;</span><span class="p">,</span> <span class="n">get_user_name_by_http_digest</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">]),</span>
<a id="__codelineno-10-56" name="__codelineno-10-56"></a>    <span class="p">]</span>
<a id="__codelineno-10-57" name="__codelineno-10-57"></a><span class="p">)</span>
<a id="__codelineno-10-58" name="__codelineno-10-58"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-10-59" name="__codelineno-10-59"></a>
<a id="__codelineno-10-60" name="__codelineno-10-60"></a>
<a id="__codelineno-10-61" name="__codelineno-10-61"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-10-62" name="__codelineno-10-62"></a>    <span class="kn">import</span> <span class="nn">uvicorn</span>
<a id="__codelineno-10-63" name="__codelineno-10-63"></a>
<a id="__codelineno-10-64" name="__codelineno-10-64"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/sanic_with_http_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span>
<span class="normal"><a href="#__codelineno-11-13">13</a></span>
<span class="normal"><a href="#__codelineno-11-14">14</a></span>
<span class="normal"><a href="#__codelineno-11-15">15</a></span>
<span class="normal"><a href="#__codelineno-11-16">16</a></span>
<span class="normal"><a href="#__codelineno-11-17">17</a></span>
<span class="normal"><a href="#__codelineno-11-18">18</a></span>
<span class="normal"><a href="#__codelineno-11-19">19</a></span>
<span class="normal"><a href="#__codelineno-11-20">20</a></span>
<span class="normal"><a href="#__codelineno-11-21">21</a></span>
<span class="normal"><a href="#__codelineno-11-22">22</a></span>
<span class="normal"><a href="#__codelineno-11-23">23</a></span>
<span class="normal"><a href="#__codelineno-11-24">24</a></span>
<span class="normal"><a href="#__codelineno-11-25">25</a></span>
<span class="normal"><a href="#__codelineno-11-26">26</a></span>
<span class="normal"><a href="#__codelineno-11-27">27</a></span>
<span class="normal"><a href="#__codelineno-11-28">28</a></span>
<span class="normal"><a href="#__codelineno-11-29">29</a></span>
<span class="normal"><a href="#__codelineno-11-30">30</a></span>
<span class="normal"><a href="#__codelineno-11-31">31</a></span>
<span class="normal"><a href="#__codelineno-11-32">32</a></span>
<span class="normal"><a href="#__codelineno-11-33">33</a></span>
<span class="normal"><a href="#__codelineno-11-34">34</a></span>
<span class="normal"><a href="#__codelineno-11-35">35</a></span>
<span class="normal"><a href="#__codelineno-11-36">36</a></span>
<span class="normal"><a href="#__codelineno-11-37">37</a></span>
<span class="normal"><a href="#__codelineno-11-38">38</a></span>
<span class="normal"><a href="#__codelineno-11-39">39</a></span>
<span class="normal"><a href="#__codelineno-11-40">40</a></span>
<span class="normal"><a href="#__codelineno-11-41">41</a></span>
<span class="normal"><a href="#__codelineno-11-42">42</a></span>
<span class="normal"><a href="#__codelineno-11-43">43</a></span>
<span class="normal"><a href="#__codelineno-11-44">44</a></span>
<span class="normal"><a href="#__codelineno-11-45">45</a></span>
<span class="normal"><a href="#__codelineno-11-46">46</a></span>
<span class="normal"><a href="#__codelineno-11-47">47</a></span>
<span class="normal"><a href="#__codelineno-11-48">48</a></span>
<span class="normal"><a href="#__codelineno-11-49">49</a></span>
<span class="normal"><a href="#__codelineno-11-50">50</a></span>
<span class="normal"><a href="#__codelineno-11-51">51</a></span>
<span class="normal"><a href="#__codelineno-11-52">52</a></span>
<span class="normal"><a href="#__codelineno-11-53">53</a></span>
<span class="normal"><a href="#__codelineno-11-54">54</a></span>
<span class="normal"><a href="#__codelineno-11-55">55</a></span>
<span class="normal"><a href="#__codelineno-11-56">56</a></span>
<span class="normal"><a href="#__codelineno-11-57">57</a></span>
<span class="normal"><a href="#__codelineno-11-58">58</a></span>
<span class="normal"><a href="#__codelineno-11-59">59</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">Sanic</span><span class="p">,</span> <span class="n">response</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="kn">from</span> <span class="nn">pait.app.sanic</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="kn">from</span> <span class="nn">pait.app.sanic.security</span> <span class="kn">import</span> <span class="n">http</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="c1">##############</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="c1"># HTTP Basic #</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="c1">##############</span>
<a id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="n">http_basic</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBasic</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBasic</span><span class="p">()</span>
<a id="__codelineno-11-14" name="__codelineno-11-14"></a>
<a id="__codelineno-11-15" name="__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="k">def</span> <span class="nf">get_user_name</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">http</span><span class="o">.</span><span class="n">HTTPBasicCredentials</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">http_basic</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-11-17" name="__codelineno-11-17"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
<a id="__codelineno-11-18" name="__codelineno-11-18"></a>        <span class="k">raise</span> <span class="n">http_basic</span><span class="o">.</span><span class="n">not_authorization_exc</span>
<a id="__codelineno-11-19" name="__codelineno-11-19"></a>    <span class="k">return</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span>
<a id="__codelineno-11-20" name="__codelineno-11-20"></a>
<a id="__codelineno-11-21" name="__codelineno-11-21"></a>
<a id="__codelineno-11-22" name="__codelineno-11-22"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-11-23" name="__codelineno-11-23"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user_name_by_http_basic_credentials</span><span class="p">(</span><span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_user_name</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">HTTPResponse</span><span class="p">:</span>
<a id="__codelineno-11-24" name="__codelineno-11-24"></a>    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_name</span><span class="p">})</span>
<a id="__codelineno-11-25" name="__codelineno-11-25"></a>
<a id="__codelineno-11-26" name="__codelineno-11-26"></a>
<a id="__codelineno-11-27" name="__codelineno-11-27"></a><span class="c1">#############</span>
<a id="__codelineno-11-28" name="__codelineno-11-28"></a><span class="c1"># HTTP Bear #</span>
<a id="__codelineno-11-29" name="__codelineno-11-29"></a><span class="c1">#############</span>
<a id="__codelineno-11-30" name="__codelineno-11-30"></a><span class="n">http_bear</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBearer</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBearer</span><span class="p">(</span><span class="n">verify_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-11-31" name="__codelineno-11-31"></a>
<a id="__codelineno-11-32" name="__codelineno-11-32"></a>
<a id="__codelineno-11-33" name="__codelineno-11-33"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-11-34" name="__codelineno-11-34"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user_name_by_http_bearer</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">http_bear</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">HTTPResponse</span><span class="p">:</span>
<a id="__codelineno-11-35" name="__codelineno-11-35"></a>    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">})</span>
<a id="__codelineno-11-36" name="__codelineno-11-36"></a>
<a id="__codelineno-11-37" name="__codelineno-11-37"></a>
<a id="__codelineno-11-38" name="__codelineno-11-38"></a><span class="c1">###############</span>
<a id="__codelineno-11-39" name="__codelineno-11-39"></a><span class="c1"># HTTP Digest #</span>
<a id="__codelineno-11-40" name="__codelineno-11-40"></a><span class="c1">###############</span>
<a id="__codelineno-11-41" name="__codelineno-11-41"></a><span class="n">http_digest</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPDigest</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPDigest</span><span class="p">(</span><span class="n">verify_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-11-42" name="__codelineno-11-42"></a>
<a id="__codelineno-11-43" name="__codelineno-11-43"></a>
<a id="__codelineno-11-44" name="__codelineno-11-44"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-11-45" name="__codelineno-11-45"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">get_user_name_by_http_digest</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">http_digest</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">response</span><span class="o">.</span><span class="n">HTTPResponse</span><span class="p">:</span>
<a id="__codelineno-11-46" name="__codelineno-11-46"></a>    <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">})</span>
<a id="__codelineno-11-47" name="__codelineno-11-47"></a>
<a id="__codelineno-11-48" name="__codelineno-11-48"></a>
<a id="__codelineno-11-49" name="__codelineno-11-49"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;demo&quot;</span><span class="p">)</span>
<a id="__codelineno-11-50" name="__codelineno-11-50"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">get_user_name_by_http_basic_credentials</span><span class="p">,</span> <span class="s2">&quot;/api/user-name-by-http-basic-credentials&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;GET&quot;</span><span class="p">})</span>
<a id="__codelineno-11-51" name="__codelineno-11-51"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">get_user_name_by_http_bearer</span><span class="p">,</span> <span class="s2">&quot;/api/user-name-by-http-bearer&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;GET&quot;</span><span class="p">})</span>
<a id="__codelineno-11-52" name="__codelineno-11-52"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">get_user_name_by_http_digest</span><span class="p">,</span> <span class="s2">&quot;/api/user-name-by-http-digest&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;GET&quot;</span><span class="p">})</span>
<a id="__codelineno-11-53" name="__codelineno-11-53"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-11-54" name="__codelineno-11-54"></a>
<a id="__codelineno-11-55" name="__codelineno-11-55"></a>
<a id="__codelineno-11-56" name="__codelineno-11-56"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-11-57" name="__codelineno-11-57"></a>    <span class="kn">import</span> <span class="nn">uvicorn</span>
<a id="__codelineno-11-58" name="__codelineno-11-58"></a>
<a id="__codelineno-11-59" name="__codelineno-11-59"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/tornado_with_http_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span>
<span class="normal"><a href="#__codelineno-12-14">14</a></span>
<span class="normal"><a href="#__codelineno-12-15">15</a></span>
<span class="normal"><a href="#__codelineno-12-16">16</a></span>
<span class="normal"><a href="#__codelineno-12-17">17</a></span>
<span class="normal"><a href="#__codelineno-12-18">18</a></span>
<span class="normal"><a href="#__codelineno-12-19">19</a></span>
<span class="normal"><a href="#__codelineno-12-20">20</a></span>
<span class="normal"><a href="#__codelineno-12-21">21</a></span>
<span class="normal"><a href="#__codelineno-12-22">22</a></span>
<span class="normal"><a href="#__codelineno-12-23">23</a></span>
<span class="normal"><a href="#__codelineno-12-24">24</a></span>
<span class="normal"><a href="#__codelineno-12-25">25</a></span>
<span class="normal"><a href="#__codelineno-12-26">26</a></span>
<span class="normal"><a href="#__codelineno-12-27">27</a></span>
<span class="normal"><a href="#__codelineno-12-28">28</a></span>
<span class="normal"><a href="#__codelineno-12-29">29</a></span>
<span class="normal"><a href="#__codelineno-12-30">30</a></span>
<span class="normal"><a href="#__codelineno-12-31">31</a></span>
<span class="normal"><a href="#__codelineno-12-32">32</a></span>
<span class="normal"><a href="#__codelineno-12-33">33</a></span>
<span class="normal"><a href="#__codelineno-12-34">34</a></span>
<span class="normal"><a href="#__codelineno-12-35">35</a></span>
<span class="normal"><a href="#__codelineno-12-36">36</a></span>
<span class="normal"><a href="#__codelineno-12-37">37</a></span>
<span class="normal"><a href="#__codelineno-12-38">38</a></span>
<span class="normal"><a href="#__codelineno-12-39">39</a></span>
<span class="normal"><a href="#__codelineno-12-40">40</a></span>
<span class="normal"><a href="#__codelineno-12-41">41</a></span>
<span class="normal"><a href="#__codelineno-12-42">42</a></span>
<span class="normal"><a href="#__codelineno-12-43">43</a></span>
<span class="normal"><a href="#__codelineno-12-44">44</a></span>
<span class="normal"><a href="#__codelineno-12-45">45</a></span>
<span class="normal"><a href="#__codelineno-12-46">46</a></span>
<span class="normal"><a href="#__codelineno-12-47">47</a></span>
<span class="normal"><a href="#__codelineno-12-48">48</a></span>
<span class="normal"><a href="#__codelineno-12-49">49</a></span>
<span class="normal"><a href="#__codelineno-12-50">50</a></span>
<span class="normal"><a href="#__codelineno-12-51">51</a></span>
<span class="normal"><a href="#__codelineno-12-52">52</a></span>
<span class="normal"><a href="#__codelineno-12-53">53</a></span>
<span class="normal"><a href="#__codelineno-12-54">54</a></span>
<span class="normal"><a href="#__codelineno-12-55">55</a></span>
<span class="normal"><a href="#__codelineno-12-56">56</a></span>
<span class="normal"><a href="#__codelineno-12-57">57</a></span>
<span class="normal"><a href="#__codelineno-12-58">58</a></span>
<span class="normal"><a href="#__codelineno-12-59">59</a></span>
<span class="normal"><a href="#__codelineno-12-60">60</a></span>
<span class="normal"><a href="#__codelineno-12-61">61</a></span>
<span class="normal"><a href="#__codelineno-12-62">62</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="kn">import</span> <span class="n">IOLoop</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="kn">from</span> <span class="nn">tornado.web</span> <span class="kn">import</span> <span class="n">Application</span><span class="p">,</span> <span class="n">RequestHandler</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="kn">from</span> <span class="nn">pait.app.tornado</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="kn">from</span> <span class="nn">pait.app.tornado.security</span> <span class="kn">import</span> <span class="n">http</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="n">http_basic</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBasic</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBasic</span><span class="p">()</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>
<a id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="k">def</span> <span class="nf">get_user_name</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">http</span><span class="o">.</span><span class="n">HTTPBasicCredentials</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">http_basic</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-12-15" name="__codelineno-12-15"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">credentials</span> <span class="ow">or</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">credentials</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
<a id="__codelineno-12-16" name="__codelineno-12-16"></a>        <span class="k">raise</span> <span class="n">http_basic</span><span class="o">.</span><span class="n">not_authorization_exc</span>
<a id="__codelineno-12-17" name="__codelineno-12-17"></a>    <span class="k">return</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span>
<a id="__codelineno-12-18" name="__codelineno-12-18"></a>
<a id="__codelineno-12-19" name="__codelineno-12-19"></a>
<a id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="k">class</span> <span class="nc">UserNameByHttpBasicCredentialsHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
<a id="__codelineno-12-21" name="__codelineno-12-21"></a>    <span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-12-22" name="__codelineno-12-22"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_user_name</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-23" name="__codelineno-12-23"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_name</span><span class="p">})</span>
<a id="__codelineno-12-24" name="__codelineno-12-24"></a>
<a id="__codelineno-12-25" name="__codelineno-12-25"></a>
<a id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="c1">#############</span>
<a id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="c1"># HTTP Bear #</span>
<a id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="c1">#############</span>
<a id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="n">http_bear</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBearer</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPBearer</span><span class="p">(</span><span class="n">verify_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-12-30" name="__codelineno-12-30"></a>
<a id="__codelineno-12-31" name="__codelineno-12-31"></a>
<a id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="k">class</span> <span class="nc">UserNameByHttpBearerHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
<a id="__codelineno-12-33" name="__codelineno-12-33"></a>    <span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-12-34" name="__codelineno-12-34"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">http_bear</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-35" name="__codelineno-12-35"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">})</span>
<a id="__codelineno-12-36" name="__codelineno-12-36"></a>
<a id="__codelineno-12-37" name="__codelineno-12-37"></a>
<a id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="c1">###############</span>
<a id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="c1"># HTTP Digest #</span>
<a id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="c1">###############</span>
<a id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="n">http_digest</span><span class="p">:</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPDigest</span> <span class="o">=</span> <span class="n">http</span><span class="o">.</span><span class="n">HTTPDigest</span><span class="p">(</span><span class="n">verify_callable</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;http&quot;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>
<a id="__codelineno-12-42" name="__codelineno-12-42"></a>
<a id="__codelineno-12-43" name="__codelineno-12-43"></a>
<a id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="k">class</span> <span class="nc">UserNameByHttpDigestHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
<a id="__codelineno-12-45" name="__codelineno-12-45"></a>    <span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-12-46" name="__codelineno-12-46"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">http_digest</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-12-47" name="__codelineno-12-47"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="p">})</span>
<a id="__codelineno-12-48" name="__codelineno-12-48"></a>
<a id="__codelineno-12-49" name="__codelineno-12-49"></a>
<a id="__codelineno-12-50" name="__codelineno-12-50"></a><span class="n">app</span><span class="p">:</span> <span class="n">Application</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span>
<a id="__codelineno-12-51" name="__codelineno-12-51"></a>    <span class="p">[</span>
<a id="__codelineno-12-52" name="__codelineno-12-52"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/user-name-by-http-basic-credentials&quot;</span><span class="p">,</span> <span class="n">UserNameByHttpBasicCredentialsHandler</span><span class="p">),</span>
<a id="__codelineno-12-53" name="__codelineno-12-53"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/user-name-by-http-bearer&quot;</span><span class="p">,</span> <span class="n">UserNameByHttpBearerHandler</span><span class="p">),</span>
<a id="__codelineno-12-54" name="__codelineno-12-54"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/user-name-by-http-digest&quot;</span><span class="p">,</span> <span class="n">UserNameByHttpDigestHandler</span><span class="p">),</span>
<a id="__codelineno-12-55" name="__codelineno-12-55"></a>    <span class="p">],</span>
<a id="__codelineno-12-56" name="__codelineno-12-56"></a><span class="p">)</span>
<a id="__codelineno-12-57" name="__codelineno-12-57"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-12-58" name="__codelineno-12-58"></a>
<a id="__codelineno-12-59" name="__codelineno-12-59"></a>
<a id="__codelineno-12-60" name="__codelineno-12-60"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-12-61" name="__codelineno-12-61"></a>    <span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>
<a id="__codelineno-12-62" name="__codelineno-12-62"></a>    <span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>You can see that the whole code consists of two parts, the first part initializes the corresponding basic authentication class,
and the second part uses <code>Depend</code> in the route function to get an instance of the authentication class.</p>
<p>However, <code>HTTPBasic</code> is used a little differently than the other two,
for example, <code>HTTPBasic</code> has different initialization parameters than the other two, which are described in the following table:</p>
<table>
<thead>
<tr>
<th>parameter</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>security_model</td>
<td>OpenAPI Description Model about HTTPBasic, a generic HTTPBasicModel has been provided by default, for customization needs visit OpenAPI's <a href="https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md#securitySchemeObject">securitySchemeObject</a></td>
</tr>
<tr>
<td>security_name</td>
<td>Specifies the name of the Security, the name of the basic authentication instance must be different for different roles, the default value is class name.</td>
</tr>
<tr>
<td>header_field</td>
<td>Instance of Header Field for <code>Pait</code></td>
</tr>
<tr>
<td>realm</td>
<td>The realm parameter of HTTP basic authentication</td>
</tr>
</tbody>
</table>
<p>While <code>HTTPBearer</code> and <code>HTTPDigest</code> are used in a similar way as <code>APIKey</code>,
they need to be initialized as required and bound to the route function via <code>Depend</code>,
their parameters are described as follows:</p>
<table>
<thead>
<tr>
<th>parameter</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>security_model</td>
<td>OpenAPI Description Model about HTTPBasic, a generic HTTPBasicModel has been provided by default, for customization needs visit OpenAPI's <a href="https://github.com/OAI/OpenAPI-Specification/blob/main/versions/3.0.3.md#securitySchemeObject">securitySchemeObject</a></td>
</tr>
<tr>
<td>security_name</td>
<td>Specifies the name of the Security, the name of the basic authentication instance must be different for different roles, the default value is class name.</td>
</tr>
<tr>
<td>header_field</td>
<td>Instance of Header Field for <code>Pait</code></td>
</tr>
<tr>
<td>is_raise</td>
<td>When set to <code>True</code>, <code>Pait</code> throws a standard error if parsing fails, and <code>False</code> returns <code>None</code> if parsing fails, default <code>True</code>.</td>
</tr>
<tr>
<td>verify_callable</td>
<td>Accepts a checksum function, <code>Pait</code> extracts the value from the request body and passes it to the checksum function, if it returns <code>True</code> it means the checksum passes, otherwise the checksum fails.</td>
</tr>
</tbody>
</table>
<p>In addition to the difference in initialization parameters,
<code>HTTPBasic</code> is not used directly in the route function,
but exists in the <code>get_user_name</code> function and the <code>get_user_name</code> function is responsible for authentication.
returning the username to the route function if the authentication is successful, otherwise returning a <code>401</code> response.</p>
<p>After running the code, execute the <code>curl</code> command to see them executed as follows:
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="c1"># Success Result</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/user-name-by-http-basic-credentials&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Basic c28xbjpzbzFu&#39;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="o">{</span><span class="s2">&quot;code&quot;</span>:0,<span class="s2">&quot;data&quot;</span>:<span class="s2">&quot;so1n&quot;</span>,<span class="s2">&quot;msg&quot;</span>:<span class="s2">&quot;&quot;</span><span class="o">}</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>➜<span class="w">   </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/user-name-by-http-bearer&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Bearer http&#39;</span>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a><span class="o">{</span><span class="s2">&quot;code&quot;</span>:0,<span class="s2">&quot;data&quot;</span>:<span class="s2">&quot;http&quot;</span>,<span class="s2">&quot;msg&quot;</span>:<span class="s2">&quot;&quot;</span><span class="o">}</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/user-name-by-http-digest&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Digest http&#39;</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a><span class="o">{</span><span class="s2">&quot;code&quot;</span>:0,<span class="s2">&quot;data&quot;</span>:<span class="s2">&quot;http&quot;</span>,<span class="s2">&quot;msg&quot;</span>:<span class="s2">&quot;&quot;</span><span class="o">}</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a>
<a id="__codelineno-13-23" name="__codelineno-13-23" href="#__codelineno-13-23"></a><span class="c1"># Fail Result</span>
<a id="__codelineno-13-24" name="__codelineno-13-24" href="#__codelineno-13-24"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-25" name="__codelineno-13-25" href="#__codelineno-13-25"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/user-name-by-http-digest&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-26" name="__codelineno-13-26" href="#__codelineno-13-26"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-27" name="__codelineno-13-27" href="#__codelineno-13-27"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Digest &#39;</span>
<a id="__codelineno-13-28" name="__codelineno-13-28" href="#__codelineno-13-28"></a>
<a id="__codelineno-13-29" name="__codelineno-13-29" href="#__codelineno-13-29"></a>&lt;!DOCTYPE<span class="w"> </span>HTML<span class="w"> </span>PUBLIC<span class="w"> </span><span class="s2">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span>&gt;
<a id="__codelineno-13-30" name="__codelineno-13-30" href="#__codelineno-13-30"></a>&lt;title&gt;403<span class="w"> </span>Forbidden&lt;/title&gt;
<a id="__codelineno-13-31" name="__codelineno-13-31" href="#__codelineno-13-31"></a>&lt;h1&gt;Forbidden&lt;/h1&gt;
<a id="__codelineno-13-32" name="__codelineno-13-32" href="#__codelineno-13-32"></a>&lt;p&gt;Not<span class="w"> </span>authenticated&lt;/p&gt;
<a id="__codelineno-13-33" name="__codelineno-13-33" href="#__codelineno-13-33"></a>
<a id="__codelineno-13-34" name="__codelineno-13-34" href="#__codelineno-13-34"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-35" name="__codelineno-13-35" href="#__codelineno-13-35"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/user-name-by-http-bearer&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-36" name="__codelineno-13-36" href="#__codelineno-13-36"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-13-37" name="__codelineno-13-37" href="#__codelineno-13-37"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Bearer &#39;</span>
<a id="__codelineno-13-38" name="__codelineno-13-38" href="#__codelineno-13-38"></a>
<a id="__codelineno-13-39" name="__codelineno-13-39" href="#__codelineno-13-39"></a>&lt;!DOCTYPE<span class="w"> </span>HTML<span class="w"> </span>PUBLIC<span class="w"> </span><span class="s2">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span>&gt;
<a id="__codelineno-13-40" name="__codelineno-13-40" href="#__codelineno-13-40"></a>&lt;title&gt;403<span class="w"> </span>Forbidden&lt;/title&gt;
<a id="__codelineno-13-41" name="__codelineno-13-41" href="#__codelineno-13-41"></a>&lt;h1&gt;Forbidden&lt;/h1&gt;
<a id="__codelineno-13-42" name="__codelineno-13-42" href="#__codelineno-13-42"></a>&lt;p&gt;Not<span class="w"> </span>authenticated&lt;/p&gt;
</code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>HTTPDigest</code> class only provides simple <code>HTTPDigest</code> authentication support,
which needs to be modified to suit your business logic when using it.</p>
</div>
<h2 id="3oauth2">3.Oauth2</h2>
<p>OAuth 2.0 is an authorization protocol that provides API clients with limited access to user data on the Web server.
In addition to providing identity verification, it also supports privilege verification, which is used as follows:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:4"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><input id="__tabbed_4_3" name="__tabbed_4" type="radio" /><input id="__tabbed_4_4" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Flask</label><label for="__tabbed_4_2">Starlette</label><label for="__tabbed_4_3">Sanic</label><label for="__tabbed_4_4">Tornado</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/flask_with_oauth2_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span>
<span class="normal"><a href="#__codelineno-14-11">11</a></span>
<span class="normal"><a href="#__codelineno-14-12">12</a></span>
<span class="normal"><a href="#__codelineno-14-13">13</a></span>
<span class="normal"><a href="#__codelineno-14-14">14</a></span>
<span class="normal"><a href="#__codelineno-14-15">15</a></span>
<span class="normal"><a href="#__codelineno-14-16">16</a></span>
<span class="normal"><a href="#__codelineno-14-17">17</a></span>
<span class="normal"><a href="#__codelineno-14-18">18</a></span>
<span class="normal"><a href="#__codelineno-14-19">19</a></span>
<span class="normal"><a href="#__codelineno-14-20">20</a></span>
<span class="normal"><a href="#__codelineno-14-21">21</a></span>
<span class="normal"><a href="#__codelineno-14-22">22</a></span>
<span class="normal"><a href="#__codelineno-14-23">23</a></span>
<span class="normal"><a href="#__codelineno-14-24">24</a></span>
<span class="normal"><a href="#__codelineno-14-25">25</a></span>
<span class="normal"><a href="#__codelineno-14-26">26</a></span>
<span class="normal"><a href="#__codelineno-14-27">27</a></span>
<span class="normal"><a href="#__codelineno-14-28">28</a></span>
<span class="normal"><a href="#__codelineno-14-29">29</a></span>
<span class="normal"><a href="#__codelineno-14-30">30</a></span>
<span class="normal"><a href="#__codelineno-14-31">31</a></span>
<span class="normal"><a href="#__codelineno-14-32">32</a></span>
<span class="normal"><a href="#__codelineno-14-33">33</a></span>
<span class="normal"><a href="#__codelineno-14-34">34</a></span>
<span class="normal"><a href="#__codelineno-14-35">35</a></span>
<span class="normal"><a href="#__codelineno-14-36">36</a></span>
<span class="normal"><a href="#__codelineno-14-37">37</a></span>
<span class="normal"><a href="#__codelineno-14-38">38</a></span>
<span class="normal"><a href="#__codelineno-14-39">39</a></span>
<span class="normal"><a href="#__codelineno-14-40">40</a></span>
<span class="normal"><a href="#__codelineno-14-41">41</a></span>
<span class="normal"><a href="#__codelineno-14-42">42</a></span>
<span class="normal"><a href="#__codelineno-14-43">43</a></span>
<span class="normal"><a href="#__codelineno-14-44">44</a></span>
<span class="normal"><a href="#__codelineno-14-45">45</a></span>
<span class="normal"><a href="#__codelineno-14-46">46</a></span>
<span class="normal"><a href="#__codelineno-14-47">47</a></span>
<span class="normal"><a href="#__codelineno-14-48">48</a></span>
<span class="normal"><a href="#__codelineno-14-49">49</a></span>
<span class="normal"><a href="#__codelineno-14-50">50</a></span>
<span class="normal"><a href="#__codelineno-14-51">51</a></span>
<span class="normal"><a href="#__codelineno-14-52">52</a></span>
<span class="normal"><a href="#__codelineno-14-53">53</a></span>
<span class="normal"><a href="#__codelineno-14-54">54</a></span>
<span class="normal"><a href="#__codelineno-14-55">55</a></span>
<span class="normal"><a href="#__codelineno-14-56">56</a></span>
<span class="normal"><a href="#__codelineno-14-57">57</a></span>
<span class="normal"><a href="#__codelineno-14-58">58</a></span>
<span class="normal"><a href="#__codelineno-14-59">59</a></span>
<span class="normal"><a href="#__codelineno-14-60">60</a></span>
<span class="normal"><a href="#__codelineno-14-61">61</a></span>
<span class="normal"><a href="#__codelineno-14-62">62</a></span>
<span class="normal"><a href="#__codelineno-14-63">63</a></span>
<span class="normal"><a href="#__codelineno-14-64">64</a></span>
<span class="normal"><a href="#__codelineno-14-65">65</a></span>
<span class="normal"><a href="#__codelineno-14-66">66</a></span>
<span class="normal"><a href="#__codelineno-14-67">67</a></span>
<span class="normal"><a href="#__codelineno-14-68">68</a></span>
<span class="normal"><a href="#__codelineno-14-69">69</a></span>
<span class="normal"><a href="#__codelineno-14-70">70</a></span>
<span class="normal"><a href="#__codelineno-14-71">71</a></span>
<span class="normal"><a href="#__codelineno-14-72">72</a></span>
<span class="normal"><a href="#__codelineno-14-73">73</a></span>
<span class="normal"><a href="#__codelineno-14-74">74</a></span>
<span class="normal"><a href="#__codelineno-14-75">75</a></span>
<span class="normal"><a href="#__codelineno-14-76">76</a></span>
<span class="normal"><a href="#__codelineno-14-77">77</a></span>
<span class="normal"><a href="#__codelineno-14-78">78</a></span>
<span class="normal"><a href="#__codelineno-14-79">79</a></span>
<span class="normal"><a href="#__codelineno-14-80">80</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="kn">import</span> <span class="nn">string</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="kn">from</span> <span class="nn">werkzeug.exceptions</span> <span class="kn">import</span> <span class="n">BadRequest</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="kn">from</span> <span class="nn">pait.app.flask</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="kn">from</span> <span class="nn">pait.app.flask.security</span> <span class="kn">import</span> <span class="n">oauth2</span>
<a id="__codelineno-14-11" name="__codelineno-14-11"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span>
<a id="__codelineno-14-12" name="__codelineno-14-12"></a><span class="kn">from</span> <span class="nn">pait.model.response</span> <span class="kn">import</span> <span class="n">Http400RespModel</span>
<a id="__codelineno-14-13" name="__codelineno-14-13"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-14-14" name="__codelineno-14-14"></a>
<a id="__codelineno-14-15" name="__codelineno-14-15"></a><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
<a id="__codelineno-14-16" name="__codelineno-14-16"></a>    <span class="kn">from</span> <span class="nn">pait.app.base.security.oauth2</span> <span class="kn">import</span> <span class="n">BaseOAuth2PasswordBearerProxy</span>
<a id="__codelineno-14-17" name="__codelineno-14-17"></a>
<a id="__codelineno-14-18" name="__codelineno-14-18"></a>
<a id="__codelineno-14-19" name="__codelineno-14-19"></a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-14-20" name="__codelineno-14-20"></a>    <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user id&quot;</span><span class="p">)</span>
<a id="__codelineno-14-21" name="__codelineno-14-21"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user name&quot;</span><span class="p">)</span>
<a id="__codelineno-14-22" name="__codelineno-14-22"></a>    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user age&quot;</span><span class="p">)</span>
<a id="__codelineno-14-23" name="__codelineno-14-23"></a>    <span class="n">sex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user sex&quot;</span><span class="p">)</span>
<a id="__codelineno-14-24" name="__codelineno-14-24"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user scopes&quot;</span><span class="p">)</span>
<a id="__codelineno-14-25" name="__codelineno-14-25"></a>
<a id="__codelineno-14-26" name="__codelineno-14-26"></a>
<a id="__codelineno-14-27" name="__codelineno-14-27"></a><span class="n">temp_token_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-14-28" name="__codelineno-14-28"></a>
<a id="__codelineno-14-29" name="__codelineno-14-29"></a>
<a id="__codelineno-14-30" name="__codelineno-14-30"></a><span class="nd">@pait</span><span class="p">(</span>
<a id="__codelineno-14-31" name="__codelineno-14-31"></a>    <span class="n">response_model_list</span><span class="o">=</span><span class="p">[</span><span class="n">Http400RespModel</span><span class="p">,</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearerJsonRespModel</span><span class="p">],</span>
<a id="__codelineno-14-32" name="__codelineno-14-32"></a><span class="p">)</span>
<a id="__codelineno-14-33" name="__codelineno-14-33"></a><span class="k">def</span> <span class="nf">oauth2_login</span><span class="p">(</span><span class="n">form_data</span><span class="p">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordRequestFrom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-14-34" name="__codelineno-14-34"></a>    <span class="k">if</span> <span class="n">form_data</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">form_data</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
<a id="__codelineno-14-35" name="__codelineno-14-35"></a>        <span class="k">raise</span> <span class="n">BadRequest</span><span class="p">()</span>
<a id="__codelineno-14-36" name="__codelineno-14-36"></a>    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-14-37" name="__codelineno-14-37"></a>    <span class="n">temp_token_dict</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="s2">&quot;123&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">form_data</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">form_data</span><span class="o">.</span><span class="n">scope</span><span class="p">)</span>
<a id="__codelineno-14-38" name="__codelineno-14-38"></a>    <span class="k">return</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearerJsonRespModel</span><span class="o">.</span><span class="n">response_data</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
<a id="__codelineno-14-39" name="__codelineno-14-39"></a>
<a id="__codelineno-14-40" name="__codelineno-14-40"></a>
<a id="__codelineno-14-41" name="__codelineno-14-41"></a><span class="n">oauth2_pb</span><span class="p">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearer</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearer</span><span class="p">(</span>
<a id="__codelineno-14-42" name="__codelineno-14-42"></a>    <span class="n">route</span><span class="o">=</span><span class="n">oauth2_login</span><span class="p">,</span>
<a id="__codelineno-14-43" name="__codelineno-14-43"></a>    <span class="n">scopes</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-14-44" name="__codelineno-14-44"></a>        <span class="s2">&quot;user-info&quot;</span><span class="p">:</span> <span class="s2">&quot;get all user info&quot;</span><span class="p">,</span>
<a id="__codelineno-14-45" name="__codelineno-14-45"></a>        <span class="s2">&quot;user-name&quot;</span><span class="p">:</span> <span class="s2">&quot;only get user name&quot;</span><span class="p">,</span>
<a id="__codelineno-14-46" name="__codelineno-14-46"></a>    <span class="p">},</span>
<a id="__codelineno-14-47" name="__codelineno-14-47"></a><span class="p">)</span>
<a id="__codelineno-14-48" name="__codelineno-14-48"></a>
<a id="__codelineno-14-49" name="__codelineno-14-49"></a>
<a id="__codelineno-14-50" name="__codelineno-14-50"></a><span class="k">def</span> <span class="nf">get_current_user</span><span class="p">(</span><span class="n">_oauth2_pb</span><span class="p">:</span> <span class="s2">&quot;BaseOAuth2PasswordBearerProxy&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">User</span><span class="p">]:</span>
<a id="__codelineno-14-51" name="__codelineno-14-51"></a>    <span class="k">def</span> <span class="nf">_check_scope</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">_oauth2_pb</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<a id="__codelineno-14-52" name="__codelineno-14-52"></a>        <span class="n">user_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_token_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-14-53" name="__codelineno-14-53"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_model</span><span class="p">:</span>
<a id="__codelineno-14-54" name="__codelineno-14-54"></a>            <span class="k">raise</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">not_authenticated_exc</span>
<a id="__codelineno-14-55" name="__codelineno-14-55"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">is_allow</span><span class="p">(</span><span class="n">user_model</span><span class="o">.</span><span class="n">scopes</span><span class="p">):</span>
<a id="__codelineno-14-56" name="__codelineno-14-56"></a>            <span class="k">raise</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">not_authenticated_exc</span>
<a id="__codelineno-14-57" name="__codelineno-14-57"></a>        <span class="k">return</span> <span class="n">user_model</span>
<a id="__codelineno-14-58" name="__codelineno-14-58"></a>
<a id="__codelineno-14-59" name="__codelineno-14-59"></a>    <span class="k">return</span> <span class="n">_check_scope</span>
<a id="__codelineno-14-60" name="__codelineno-14-60"></a>
<a id="__codelineno-14-61" name="__codelineno-14-61"></a>
<a id="__codelineno-14-62" name="__codelineno-14-62"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-14-63" name="__codelineno-14-63"></a><span class="k">def</span> <span class="nf">oauth2_user_name</span><span class="p">(</span><span class="n">user_model</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">(</span><span class="n">oauth2_pb</span><span class="o">.</span><span class="n">get_depend</span><span class="p">([</span><span class="s2">&quot;user-name&quot;</span><span class="p">]))))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-14-64" name="__codelineno-14-64"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_model</span><span class="o">.</span><span class="n">name</span><span class="p">}</span>
<a id="__codelineno-14-65" name="__codelineno-14-65"></a>
<a id="__codelineno-14-66" name="__codelineno-14-66"></a>
<a id="__codelineno-14-67" name="__codelineno-14-67"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-14-68" name="__codelineno-14-68"></a><span class="k">def</span> <span class="nf">oauth2_user_info</span><span class="p">(</span><span class="n">user_model</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">(</span><span class="n">oauth2_pb</span><span class="o">.</span><span class="n">get_depend</span><span class="p">([</span><span class="s2">&quot;user-info&quot;</span><span class="p">]))))</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-14-69" name="__codelineno-14-69"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_model</span><span class="o">.</span><span class="n">dict</span><span class="p">()}</span>
<a id="__codelineno-14-70" name="__codelineno-14-70"></a>
<a id="__codelineno-14-71" name="__codelineno-14-71"></a>
<a id="__codelineno-14-72" name="__codelineno-14-72"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">)</span>
<a id="__codelineno-14-73" name="__codelineno-14-73"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/oauth2-login&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">oauth2_login</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<a id="__codelineno-14-74" name="__codelineno-14-74"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/oauth2-user-name&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">oauth2_user_name</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-14-75" name="__codelineno-14-75"></a><span class="n">app</span><span class="o">.</span><span class="n">add_url_rule</span><span class="p">(</span><span class="s2">&quot;/api/oauth2-user-info&quot;</span><span class="p">,</span> <span class="n">view_func</span><span class="o">=</span><span class="n">oauth2_user_info</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-14-76" name="__codelineno-14-76"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-14-77" name="__codelineno-14-77"></a>
<a id="__codelineno-14-78" name="__codelineno-14-78"></a>
<a id="__codelineno-14-79" name="__codelineno-14-79"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-14-80" name="__codelineno-14-80"></a>    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/starlette_with_oauth2_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-15-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-15-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-15-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-15-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-15-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-15-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-15-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-15-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-15-10">10</a></span>
<span class="normal"><a href="#__codelineno-15-11">11</a></span>
<span class="normal"><a href="#__codelineno-15-12">12</a></span>
<span class="normal"><a href="#__codelineno-15-13">13</a></span>
<span class="normal"><a href="#__codelineno-15-14">14</a></span>
<span class="normal"><a href="#__codelineno-15-15">15</a></span>
<span class="normal"><a href="#__codelineno-15-16">16</a></span>
<span class="normal"><a href="#__codelineno-15-17">17</a></span>
<span class="normal"><a href="#__codelineno-15-18">18</a></span>
<span class="normal"><a href="#__codelineno-15-19">19</a></span>
<span class="normal"><a href="#__codelineno-15-20">20</a></span>
<span class="normal"><a href="#__codelineno-15-21">21</a></span>
<span class="normal"><a href="#__codelineno-15-22">22</a></span>
<span class="normal"><a href="#__codelineno-15-23">23</a></span>
<span class="normal"><a href="#__codelineno-15-24">24</a></span>
<span class="normal"><a href="#__codelineno-15-25">25</a></span>
<span class="normal"><a href="#__codelineno-15-26">26</a></span>
<span class="normal"><a href="#__codelineno-15-27">27</a></span>
<span class="normal"><a href="#__codelineno-15-28">28</a></span>
<span class="normal"><a href="#__codelineno-15-29">29</a></span>
<span class="normal"><a href="#__codelineno-15-30">30</a></span>
<span class="normal"><a href="#__codelineno-15-31">31</a></span>
<span class="normal"><a href="#__codelineno-15-32">32</a></span>
<span class="normal"><a href="#__codelineno-15-33">33</a></span>
<span class="normal"><a href="#__codelineno-15-34">34</a></span>
<span class="normal"><a href="#__codelineno-15-35">35</a></span>
<span class="normal"><a href="#__codelineno-15-36">36</a></span>
<span class="normal"><a href="#__codelineno-15-37">37</a></span>
<span class="normal"><a href="#__codelineno-15-38">38</a></span>
<span class="normal"><a href="#__codelineno-15-39">39</a></span>
<span class="normal"><a href="#__codelineno-15-40">40</a></span>
<span class="normal"><a href="#__codelineno-15-41">41</a></span>
<span class="normal"><a href="#__codelineno-15-42">42</a></span>
<span class="normal"><a href="#__codelineno-15-43">43</a></span>
<span class="normal"><a href="#__codelineno-15-44">44</a></span>
<span class="normal"><a href="#__codelineno-15-45">45</a></span>
<span class="normal"><a href="#__codelineno-15-46">46</a></span>
<span class="normal"><a href="#__codelineno-15-47">47</a></span>
<span class="normal"><a href="#__codelineno-15-48">48</a></span>
<span class="normal"><a href="#__codelineno-15-49">49</a></span>
<span class="normal"><a href="#__codelineno-15-50">50</a></span>
<span class="normal"><a href="#__codelineno-15-51">51</a></span>
<span class="normal"><a href="#__codelineno-15-52">52</a></span>
<span class="normal"><a href="#__codelineno-15-53">53</a></span>
<span class="normal"><a href="#__codelineno-15-54">54</a></span>
<span class="normal"><a href="#__codelineno-15-55">55</a></span>
<span class="normal"><a href="#__codelineno-15-56">56</a></span>
<span class="normal"><a href="#__codelineno-15-57">57</a></span>
<span class="normal"><a href="#__codelineno-15-58">58</a></span>
<span class="normal"><a href="#__codelineno-15-59">59</a></span>
<span class="normal"><a href="#__codelineno-15-60">60</a></span>
<span class="normal"><a href="#__codelineno-15-61">61</a></span>
<span class="normal"><a href="#__codelineno-15-62">62</a></span>
<span class="normal"><a href="#__codelineno-15-63">63</a></span>
<span class="normal"><a href="#__codelineno-15-64">64</a></span>
<span class="normal"><a href="#__codelineno-15-65">65</a></span>
<span class="normal"><a href="#__codelineno-15-66">66</a></span>
<span class="normal"><a href="#__codelineno-15-67">67</a></span>
<span class="normal"><a href="#__codelineno-15-68">68</a></span>
<span class="normal"><a href="#__codelineno-15-69">69</a></span>
<span class="normal"><a href="#__codelineno-15-70">70</a></span>
<span class="normal"><a href="#__codelineno-15-71">71</a></span>
<span class="normal"><a href="#__codelineno-15-72">72</a></span>
<span class="normal"><a href="#__codelineno-15-73">73</a></span>
<span class="normal"><a href="#__codelineno-15-74">74</a></span>
<span class="normal"><a href="#__codelineno-15-75">75</a></span>
<span class="normal"><a href="#__codelineno-15-76">76</a></span>
<span class="normal"><a href="#__codelineno-15-77">77</a></span>
<span class="normal"><a href="#__codelineno-15-78">78</a></span>
<span class="normal"><a href="#__codelineno-15-79">79</a></span>
<span class="normal"><a href="#__codelineno-15-80">80</a></span>
<span class="normal"><a href="#__codelineno-15-81">81</a></span>
<span class="normal"><a href="#__codelineno-15-82">82</a></span>
<span class="normal"><a href="#__codelineno-15-83">83</a></span>
<span class="normal"><a href="#__codelineno-15-84">84</a></span>
<span class="normal"><a href="#__codelineno-15-85">85</a></span>
<span class="normal"><a href="#__codelineno-15-86">86</a></span>
<span class="normal"><a href="#__codelineno-15-87">87</a></span>
<span class="normal"><a href="#__codelineno-15-88">88</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="kn">import</span> <span class="nn">string</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="kn">from</span> <span class="nn">starlette.applications</span> <span class="kn">import</span> <span class="n">Starlette</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="kn">from</span> <span class="nn">starlette.exceptions</span> <span class="kn">import</span> <span class="n">HTTPException</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="kn">from</span> <span class="nn">starlette.responses</span> <span class="kn">import</span> <span class="n">JSONResponse</span>
<a id="__codelineno-15-9" name="__codelineno-15-9"></a>
<a id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="kn">from</span> <span class="nn">pait.app.starlette</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="kn">from</span> <span class="nn">pait.app.starlette.security</span> <span class="kn">import</span> <span class="n">oauth2</span>
<a id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span>
<a id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="kn">from</span> <span class="nn">pait.model.response</span> <span class="kn">import</span> <span class="n">Http400RespModel</span><span class="p">,</span> <span class="n">TextResponseModel</span>
<a id="__codelineno-15-14" name="__codelineno-15-14"></a>
<a id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
<a id="__codelineno-15-16" name="__codelineno-15-16"></a>    <span class="kn">from</span> <span class="nn">pait.app.base.security.oauth2</span> <span class="kn">import</span> <span class="n">BaseOAuth2PasswordBearerProxy</span>
<a id="__codelineno-15-17" name="__codelineno-15-17"></a>
<a id="__codelineno-15-18" name="__codelineno-15-18"></a>
<a id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-15-20" name="__codelineno-15-20"></a>    <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user id&quot;</span><span class="p">)</span>
<a id="__codelineno-15-21" name="__codelineno-15-21"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user name&quot;</span><span class="p">)</span>
<a id="__codelineno-15-22" name="__codelineno-15-22"></a>    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user age&quot;</span><span class="p">)</span>
<a id="__codelineno-15-23" name="__codelineno-15-23"></a>    <span class="n">sex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user sex&quot;</span><span class="p">)</span>
<a id="__codelineno-15-24" name="__codelineno-15-24"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user scopes&quot;</span><span class="p">)</span>
<a id="__codelineno-15-25" name="__codelineno-15-25"></a>
<a id="__codelineno-15-26" name="__codelineno-15-26"></a>
<a id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="n">temp_token_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-15-28" name="__codelineno-15-28"></a>
<a id="__codelineno-15-29" name="__codelineno-15-29"></a>
<a id="__codelineno-15-30" name="__codelineno-15-30"></a><span class="nd">@pait</span><span class="p">(</span>
<a id="__codelineno-15-31" name="__codelineno-15-31"></a>    <span class="n">response_model_list</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-15-32" name="__codelineno-15-32"></a>        <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearerJsonRespModel</span><span class="p">,</span>
<a id="__codelineno-15-33" name="__codelineno-15-33"></a>        <span class="n">Http400RespModel</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">resp_model</span><span class="o">=</span><span class="n">TextResponseModel</span><span class="p">),</span>
<a id="__codelineno-15-34" name="__codelineno-15-34"></a>    <span class="p">],</span>
<a id="__codelineno-15-35" name="__codelineno-15-35"></a><span class="p">)</span>
<a id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">oauth2_login</span><span class="p">(</span><span class="n">form_data</span><span class="p">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordRequestFrom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
<a id="__codelineno-15-37" name="__codelineno-15-37"></a>    <span class="k">if</span> <span class="n">form_data</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">form_data</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
<a id="__codelineno-15-38" name="__codelineno-15-38"></a>        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<a id="__codelineno-15-39" name="__codelineno-15-39"></a>    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-15-40" name="__codelineno-15-40"></a>    <span class="n">temp_token_dict</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="s2">&quot;123&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">form_data</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">form_data</span><span class="o">.</span><span class="n">scope</span><span class="p">)</span>
<a id="__codelineno-15-41" name="__codelineno-15-41"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearerJsonRespModel</span><span class="o">.</span><span class="n">response_data</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
<a id="__codelineno-15-42" name="__codelineno-15-42"></a>
<a id="__codelineno-15-43" name="__codelineno-15-43"></a>
<a id="__codelineno-15-44" name="__codelineno-15-44"></a><span class="n">oauth2_pb</span><span class="p">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearer</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearer</span><span class="p">(</span>
<a id="__codelineno-15-45" name="__codelineno-15-45"></a>    <span class="n">route</span><span class="o">=</span><span class="n">oauth2_login</span><span class="p">,</span>
<a id="__codelineno-15-46" name="__codelineno-15-46"></a>    <span class="n">scopes</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-15-47" name="__codelineno-15-47"></a>        <span class="s2">&quot;user-info&quot;</span><span class="p">:</span> <span class="s2">&quot;get all user info&quot;</span><span class="p">,</span>
<a id="__codelineno-15-48" name="__codelineno-15-48"></a>        <span class="s2">&quot;user-name&quot;</span><span class="p">:</span> <span class="s2">&quot;only get user name&quot;</span><span class="p">,</span>
<a id="__codelineno-15-49" name="__codelineno-15-49"></a>    <span class="p">},</span>
<a id="__codelineno-15-50" name="__codelineno-15-50"></a><span class="p">)</span>
<a id="__codelineno-15-51" name="__codelineno-15-51"></a>
<a id="__codelineno-15-52" name="__codelineno-15-52"></a>
<a id="__codelineno-15-53" name="__codelineno-15-53"></a><span class="k">def</span> <span class="nf">get_current_user</span><span class="p">(</span><span class="n">_oauth2_pb</span><span class="p">:</span> <span class="s2">&quot;BaseOAuth2PasswordBearerProxy&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">User</span><span class="p">]:</span>
<a id="__codelineno-15-54" name="__codelineno-15-54"></a>    <span class="k">def</span> <span class="nf">_check_scope</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">_oauth2_pb</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<a id="__codelineno-15-55" name="__codelineno-15-55"></a>        <span class="n">user_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_token_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-15-56" name="__codelineno-15-56"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_model</span><span class="p">:</span>
<a id="__codelineno-15-57" name="__codelineno-15-57"></a>            <span class="k">raise</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">not_authenticated_exc</span>
<a id="__codelineno-15-58" name="__codelineno-15-58"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">is_allow</span><span class="p">(</span><span class="n">user_model</span><span class="o">.</span><span class="n">scopes</span><span class="p">):</span>
<a id="__codelineno-15-59" name="__codelineno-15-59"></a>            <span class="k">raise</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">not_authenticated_exc</span>
<a id="__codelineno-15-60" name="__codelineno-15-60"></a>        <span class="k">return</span> <span class="n">user_model</span>
<a id="__codelineno-15-61" name="__codelineno-15-61"></a>
<a id="__codelineno-15-62" name="__codelineno-15-62"></a>    <span class="k">return</span> <span class="n">_check_scope</span>
<a id="__codelineno-15-63" name="__codelineno-15-63"></a>
<a id="__codelineno-15-64" name="__codelineno-15-64"></a>
<a id="__codelineno-15-65" name="__codelineno-15-65"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-15-66" name="__codelineno-15-66"></a><span class="k">def</span> <span class="nf">oauth2_user_name</span><span class="p">(</span>
<a id="__codelineno-15-67" name="__codelineno-15-67"></a>    <span class="n">user_model</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">(</span><span class="n">oauth2_pb</span><span class="o">.</span><span class="n">get_depend</span><span class="p">([</span><span class="s2">&quot;user-name&quot;</span><span class="p">]))),</span>
<a id="__codelineno-15-68" name="__codelineno-15-68"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
<a id="__codelineno-15-69" name="__codelineno-15-69"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_model</span><span class="o">.</span><span class="n">name</span><span class="p">})</span>
<a id="__codelineno-15-70" name="__codelineno-15-70"></a>
<a id="__codelineno-15-71" name="__codelineno-15-71"></a>
<a id="__codelineno-15-72" name="__codelineno-15-72"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-15-73" name="__codelineno-15-73"></a><span class="k">def</span> <span class="nf">oauth2_user_info</span><span class="p">(</span>
<a id="__codelineno-15-74" name="__codelineno-15-74"></a>    <span class="n">user_model</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">(</span><span class="n">oauth2_pb</span><span class="o">.</span><span class="n">get_depend</span><span class="p">([</span><span class="s2">&quot;user-info&quot;</span><span class="p">]))),</span>
<a id="__codelineno-15-75" name="__codelineno-15-75"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
<a id="__codelineno-15-76" name="__codelineno-15-76"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_model</span><span class="o">.</span><span class="n">dict</span><span class="p">()})</span>
<a id="__codelineno-15-77" name="__codelineno-15-77"></a>
<a id="__codelineno-15-78" name="__codelineno-15-78"></a>
<a id="__codelineno-15-79" name="__codelineno-15-79"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Starlette</span><span class="p">()</span>
<a id="__codelineno-15-80" name="__codelineno-15-80"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s2">&quot;/api/oauth2-login&quot;</span><span class="p">,</span> <span class="n">oauth2_login</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
<a id="__codelineno-15-81" name="__codelineno-15-81"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s2">&quot;/api/oauth2-user-name&quot;</span><span class="p">,</span> <span class="n">oauth2_user_name</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-15-82" name="__codelineno-15-82"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s2">&quot;/api/oauth2-user-info&quot;</span><span class="p">,</span> <span class="n">oauth2_user_info</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">])</span>
<a id="__codelineno-15-83" name="__codelineno-15-83"></a>
<a id="__codelineno-15-84" name="__codelineno-15-84"></a>
<a id="__codelineno-15-85" name="__codelineno-15-85"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-15-86" name="__codelineno-15-86"></a>    <span class="kn">import</span> <span class="nn">uvicorn</span>
<a id="__codelineno-15-87" name="__codelineno-15-87"></a>
<a id="__codelineno-15-88" name="__codelineno-15-88"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/sanic_with_oauth2_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span>
<span class="normal"><a href="#__codelineno-16-13">13</a></span>
<span class="normal"><a href="#__codelineno-16-14">14</a></span>
<span class="normal"><a href="#__codelineno-16-15">15</a></span>
<span class="normal"><a href="#__codelineno-16-16">16</a></span>
<span class="normal"><a href="#__codelineno-16-17">17</a></span>
<span class="normal"><a href="#__codelineno-16-18">18</a></span>
<span class="normal"><a href="#__codelineno-16-19">19</a></span>
<span class="normal"><a href="#__codelineno-16-20">20</a></span>
<span class="normal"><a href="#__codelineno-16-21">21</a></span>
<span class="normal"><a href="#__codelineno-16-22">22</a></span>
<span class="normal"><a href="#__codelineno-16-23">23</a></span>
<span class="normal"><a href="#__codelineno-16-24">24</a></span>
<span class="normal"><a href="#__codelineno-16-25">25</a></span>
<span class="normal"><a href="#__codelineno-16-26">26</a></span>
<span class="normal"><a href="#__codelineno-16-27">27</a></span>
<span class="normal"><a href="#__codelineno-16-28">28</a></span>
<span class="normal"><a href="#__codelineno-16-29">29</a></span>
<span class="normal"><a href="#__codelineno-16-30">30</a></span>
<span class="normal"><a href="#__codelineno-16-31">31</a></span>
<span class="normal"><a href="#__codelineno-16-32">32</a></span>
<span class="normal"><a href="#__codelineno-16-33">33</a></span>
<span class="normal"><a href="#__codelineno-16-34">34</a></span>
<span class="normal"><a href="#__codelineno-16-35">35</a></span>
<span class="normal"><a href="#__codelineno-16-36">36</a></span>
<span class="normal"><a href="#__codelineno-16-37">37</a></span>
<span class="normal"><a href="#__codelineno-16-38">38</a></span>
<span class="normal"><a href="#__codelineno-16-39">39</a></span>
<span class="normal"><a href="#__codelineno-16-40">40</a></span>
<span class="normal"><a href="#__codelineno-16-41">41</a></span>
<span class="normal"><a href="#__codelineno-16-42">42</a></span>
<span class="normal"><a href="#__codelineno-16-43">43</a></span>
<span class="normal"><a href="#__codelineno-16-44">44</a></span>
<span class="normal"><a href="#__codelineno-16-45">45</a></span>
<span class="normal"><a href="#__codelineno-16-46">46</a></span>
<span class="normal"><a href="#__codelineno-16-47">47</a></span>
<span class="normal"><a href="#__codelineno-16-48">48</a></span>
<span class="normal"><a href="#__codelineno-16-49">49</a></span>
<span class="normal"><a href="#__codelineno-16-50">50</a></span>
<span class="normal"><a href="#__codelineno-16-51">51</a></span>
<span class="normal"><a href="#__codelineno-16-52">52</a></span>
<span class="normal"><a href="#__codelineno-16-53">53</a></span>
<span class="normal"><a href="#__codelineno-16-54">54</a></span>
<span class="normal"><a href="#__codelineno-16-55">55</a></span>
<span class="normal"><a href="#__codelineno-16-56">56</a></span>
<span class="normal"><a href="#__codelineno-16-57">57</a></span>
<span class="normal"><a href="#__codelineno-16-58">58</a></span>
<span class="normal"><a href="#__codelineno-16-59">59</a></span>
<span class="normal"><a href="#__codelineno-16-60">60</a></span>
<span class="normal"><a href="#__codelineno-16-61">61</a></span>
<span class="normal"><a href="#__codelineno-16-62">62</a></span>
<span class="normal"><a href="#__codelineno-16-63">63</a></span>
<span class="normal"><a href="#__codelineno-16-64">64</a></span>
<span class="normal"><a href="#__codelineno-16-65">65</a></span>
<span class="normal"><a href="#__codelineno-16-66">66</a></span>
<span class="normal"><a href="#__codelineno-16-67">67</a></span>
<span class="normal"><a href="#__codelineno-16-68">68</a></span>
<span class="normal"><a href="#__codelineno-16-69">69</a></span>
<span class="normal"><a href="#__codelineno-16-70">70</a></span>
<span class="normal"><a href="#__codelineno-16-71">71</a></span>
<span class="normal"><a href="#__codelineno-16-72">72</a></span>
<span class="normal"><a href="#__codelineno-16-73">73</a></span>
<span class="normal"><a href="#__codelineno-16-74">74</a></span>
<span class="normal"><a href="#__codelineno-16-75">75</a></span>
<span class="normal"><a href="#__codelineno-16-76">76</a></span>
<span class="normal"><a href="#__codelineno-16-77">77</a></span>
<span class="normal"><a href="#__codelineno-16-78">78</a></span>
<span class="normal"><a href="#__codelineno-16-79">79</a></span>
<span class="normal"><a href="#__codelineno-16-80">80</a></span>
<span class="normal"><a href="#__codelineno-16-81">81</a></span>
<span class="normal"><a href="#__codelineno-16-82">82</a></span>
<span class="normal"><a href="#__codelineno-16-83">83</a></span>
<span class="normal"><a href="#__codelineno-16-84">84</a></span>
<span class="normal"><a href="#__codelineno-16-85">85</a></span>
<span class="normal"><a href="#__codelineno-16-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="kn">import</span> <span class="nn">string</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="kn">from</span> <span class="nn">sanic</span> <span class="kn">import</span> <span class="n">HTTPResponse</span><span class="p">,</span> <span class="n">Sanic</span><span class="p">,</span> <span class="n">json</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="kn">from</span> <span class="nn">sanic.exceptions</span> <span class="kn">import</span> <span class="n">InvalidUsage</span>
<a id="__codelineno-16-8" name="__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9"></a><span class="kn">from</span> <span class="nn">pait.app.sanic</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-16-10" name="__codelineno-16-10"></a><span class="kn">from</span> <span class="nn">pait.app.sanic.security</span> <span class="kn">import</span> <span class="n">oauth2</span>
<a id="__codelineno-16-11" name="__codelineno-16-11"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span>
<a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="kn">from</span> <span class="nn">pait.model.response</span> <span class="kn">import</span> <span class="n">Http400RespModel</span>
<a id="__codelineno-16-13" name="__codelineno-16-13"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-16-14" name="__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15"></a><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
<a id="__codelineno-16-16" name="__codelineno-16-16"></a>    <span class="kn">from</span> <span class="nn">pait.app.base.security.oauth2</span> <span class="kn">import</span> <span class="n">BaseOAuth2PasswordBearerProxy</span>
<a id="__codelineno-16-17" name="__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18"></a>
<a id="__codelineno-16-19" name="__codelineno-16-19"></a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-16-20" name="__codelineno-16-20"></a>    <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user id&quot;</span><span class="p">)</span>
<a id="__codelineno-16-21" name="__codelineno-16-21"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user name&quot;</span><span class="p">)</span>
<a id="__codelineno-16-22" name="__codelineno-16-22"></a>    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user age&quot;</span><span class="p">)</span>
<a id="__codelineno-16-23" name="__codelineno-16-23"></a>    <span class="n">sex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user sex&quot;</span><span class="p">)</span>
<a id="__codelineno-16-24" name="__codelineno-16-24"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user scopes&quot;</span><span class="p">)</span>
<a id="__codelineno-16-25" name="__codelineno-16-25"></a>
<a id="__codelineno-16-26" name="__codelineno-16-26"></a>
<a id="__codelineno-16-27" name="__codelineno-16-27"></a><span class="n">temp_token_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-16-28" name="__codelineno-16-28"></a>
<a id="__codelineno-16-29" name="__codelineno-16-29"></a>
<a id="__codelineno-16-30" name="__codelineno-16-30"></a><span class="nd">@pait</span><span class="p">(</span>
<a id="__codelineno-16-31" name="__codelineno-16-31"></a>    <span class="n">response_model_list</span><span class="o">=</span><span class="p">[</span><span class="n">Http400RespModel</span><span class="p">,</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearerJsonRespModel</span><span class="p">],</span>
<a id="__codelineno-16-32" name="__codelineno-16-32"></a><span class="p">)</span>
<a id="__codelineno-16-33" name="__codelineno-16-33"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">oauth2_login</span><span class="p">(</span><span class="n">form_data</span><span class="p">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordRequestFrom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HTTPResponse</span><span class="p">:</span>
<a id="__codelineno-16-34" name="__codelineno-16-34"></a>    <span class="k">if</span> <span class="n">form_data</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">form_data</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
<a id="__codelineno-16-35" name="__codelineno-16-35"></a>        <span class="k">raise</span> <span class="n">InvalidUsage</span><span class="p">(</span><span class="s2">&quot;Bad Request&quot;</span><span class="p">)</span>
<a id="__codelineno-16-36" name="__codelineno-16-36"></a>    <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-16-37" name="__codelineno-16-37"></a>    <span class="n">temp_token_dict</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="s2">&quot;123&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">form_data</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">form_data</span><span class="o">.</span><span class="n">scope</span><span class="p">)</span>
<a id="__codelineno-16-38" name="__codelineno-16-38"></a>    <span class="k">return</span> <span class="n">json</span><span class="p">(</span><span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearerJsonRespModel</span><span class="o">.</span><span class="n">response_data</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
<a id="__codelineno-16-39" name="__codelineno-16-39"></a>
<a id="__codelineno-16-40" name="__codelineno-16-40"></a>
<a id="__codelineno-16-41" name="__codelineno-16-41"></a><span class="n">oauth2_pb</span><span class="p">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearer</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearer</span><span class="p">(</span>
<a id="__codelineno-16-42" name="__codelineno-16-42"></a>    <span class="n">route</span><span class="o">=</span><span class="n">oauth2_login</span><span class="p">,</span>
<a id="__codelineno-16-43" name="__codelineno-16-43"></a>    <span class="n">scopes</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-16-44" name="__codelineno-16-44"></a>        <span class="s2">&quot;user-info&quot;</span><span class="p">:</span> <span class="s2">&quot;get all user info&quot;</span><span class="p">,</span>
<a id="__codelineno-16-45" name="__codelineno-16-45"></a>        <span class="s2">&quot;user-name&quot;</span><span class="p">:</span> <span class="s2">&quot;only get user name&quot;</span><span class="p">,</span>
<a id="__codelineno-16-46" name="__codelineno-16-46"></a>    <span class="p">},</span>
<a id="__codelineno-16-47" name="__codelineno-16-47"></a><span class="p">)</span>
<a id="__codelineno-16-48" name="__codelineno-16-48"></a>
<a id="__codelineno-16-49" name="__codelineno-16-49"></a>
<a id="__codelineno-16-50" name="__codelineno-16-50"></a><span class="k">def</span> <span class="nf">get_current_user</span><span class="p">(</span><span class="n">_oauth2_pb</span><span class="p">:</span> <span class="s2">&quot;BaseOAuth2PasswordBearerProxy&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">User</span><span class="p">]:</span>
<a id="__codelineno-16-51" name="__codelineno-16-51"></a>    <span class="k">def</span> <span class="nf">_check_scope</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">_oauth2_pb</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<a id="__codelineno-16-52" name="__codelineno-16-52"></a>        <span class="n">user_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_token_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-16-53" name="__codelineno-16-53"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_model</span><span class="p">:</span>
<a id="__codelineno-16-54" name="__codelineno-16-54"></a>            <span class="k">raise</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">not_authenticated_exc</span>
<a id="__codelineno-16-55" name="__codelineno-16-55"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">is_allow</span><span class="p">(</span><span class="n">user_model</span><span class="o">.</span><span class="n">scopes</span><span class="p">):</span>
<a id="__codelineno-16-56" name="__codelineno-16-56"></a>            <span class="k">raise</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">not_authenticated_exc</span>
<a id="__codelineno-16-57" name="__codelineno-16-57"></a>        <span class="k">return</span> <span class="n">user_model</span>
<a id="__codelineno-16-58" name="__codelineno-16-58"></a>
<a id="__codelineno-16-59" name="__codelineno-16-59"></a>    <span class="k">return</span> <span class="n">_check_scope</span>
<a id="__codelineno-16-60" name="__codelineno-16-60"></a>
<a id="__codelineno-16-61" name="__codelineno-16-61"></a>
<a id="__codelineno-16-62" name="__codelineno-16-62"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-16-63" name="__codelineno-16-63"></a><span class="k">def</span> <span class="nf">oauth2_user_name</span><span class="p">(</span>
<a id="__codelineno-16-64" name="__codelineno-16-64"></a>    <span class="n">user_model</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">(</span><span class="n">oauth2_pb</span><span class="o">.</span><span class="n">get_depend</span><span class="p">([</span><span class="s2">&quot;user-name&quot;</span><span class="p">]))),</span>
<a id="__codelineno-16-65" name="__codelineno-16-65"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HTTPResponse</span><span class="p">:</span>
<a id="__codelineno-16-66" name="__codelineno-16-66"></a>    <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_model</span><span class="o">.</span><span class="n">name</span><span class="p">})</span>
<a id="__codelineno-16-67" name="__codelineno-16-67"></a>
<a id="__codelineno-16-68" name="__codelineno-16-68"></a>
<a id="__codelineno-16-69" name="__codelineno-16-69"></a><span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-16-70" name="__codelineno-16-70"></a><span class="k">async</span> <span class="k">def</span> <span class="nf">oauth2_user_info</span><span class="p">(</span>
<a id="__codelineno-16-71" name="__codelineno-16-71"></a>    <span class="n">user_model</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">(</span><span class="n">oauth2_pb</span><span class="o">.</span><span class="n">get_depend</span><span class="p">([</span><span class="s2">&quot;user-info&quot;</span><span class="p">]))),</span>
<a id="__codelineno-16-72" name="__codelineno-16-72"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HTTPResponse</span><span class="p">:</span>
<a id="__codelineno-16-73" name="__codelineno-16-73"></a>    <span class="k">return</span> <span class="n">json</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_model</span><span class="o">.</span><span class="n">dict</span><span class="p">()})</span>
<a id="__codelineno-16-74" name="__codelineno-16-74"></a>
<a id="__codelineno-16-75" name="__codelineno-16-75"></a>
<a id="__codelineno-16-76" name="__codelineno-16-76"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Sanic</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;demo&quot;</span><span class="p">)</span>
<a id="__codelineno-16-77" name="__codelineno-16-77"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">oauth2_login</span><span class="p">,</span> <span class="s2">&quot;/api/oauth2-login&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;POST&quot;</span><span class="p">})</span>
<a id="__codelineno-16-78" name="__codelineno-16-78"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">oauth2_user_name</span><span class="p">,</span> <span class="s2">&quot;/api/oauth2-user-name&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;GET&quot;</span><span class="p">})</span>
<a id="__codelineno-16-79" name="__codelineno-16-79"></a><span class="n">app</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="n">oauth2_user_info</span><span class="p">,</span> <span class="s2">&quot;/api/oauth2-user-info&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;GET&quot;</span><span class="p">})</span>
<a id="__codelineno-16-80" name="__codelineno-16-80"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-16-81" name="__codelineno-16-81"></a>
<a id="__codelineno-16-82" name="__codelineno-16-82"></a>
<a id="__codelineno-16-83" name="__codelineno-16-83"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-16-84" name="__codelineno-16-84"></a>    <span class="kn">import</span> <span class="nn">uvicorn</span>
<a id="__codelineno-16-85" name="__codelineno-16-85"></a>
<a id="__codelineno-16-86" name="__codelineno-16-86"></a>    <span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">docs_source_code/openapi/security/tornado_with_oauth2_demo.py</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-17-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-17-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-17-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-17-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-17-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-17-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-17-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-17-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-17-10">10</a></span>
<span class="normal"><a href="#__codelineno-17-11">11</a></span>
<span class="normal"><a href="#__codelineno-17-12">12</a></span>
<span class="normal"><a href="#__codelineno-17-13">13</a></span>
<span class="normal"><a href="#__codelineno-17-14">14</a></span>
<span class="normal"><a href="#__codelineno-17-15">15</a></span>
<span class="normal"><a href="#__codelineno-17-16">16</a></span>
<span class="normal"><a href="#__codelineno-17-17">17</a></span>
<span class="normal"><a href="#__codelineno-17-18">18</a></span>
<span class="normal"><a href="#__codelineno-17-19">19</a></span>
<span class="normal"><a href="#__codelineno-17-20">20</a></span>
<span class="normal"><a href="#__codelineno-17-21">21</a></span>
<span class="normal"><a href="#__codelineno-17-22">22</a></span>
<span class="normal"><a href="#__codelineno-17-23">23</a></span>
<span class="normal"><a href="#__codelineno-17-24">24</a></span>
<span class="normal"><a href="#__codelineno-17-25">25</a></span>
<span class="normal"><a href="#__codelineno-17-26">26</a></span>
<span class="normal"><a href="#__codelineno-17-27">27</a></span>
<span class="normal"><a href="#__codelineno-17-28">28</a></span>
<span class="normal"><a href="#__codelineno-17-29">29</a></span>
<span class="normal"><a href="#__codelineno-17-30">30</a></span>
<span class="normal"><a href="#__codelineno-17-31">31</a></span>
<span class="normal"><a href="#__codelineno-17-32">32</a></span>
<span class="normal"><a href="#__codelineno-17-33">33</a></span>
<span class="normal"><a href="#__codelineno-17-34">34</a></span>
<span class="normal"><a href="#__codelineno-17-35">35</a></span>
<span class="normal"><a href="#__codelineno-17-36">36</a></span>
<span class="normal"><a href="#__codelineno-17-37">37</a></span>
<span class="normal"><a href="#__codelineno-17-38">38</a></span>
<span class="normal"><a href="#__codelineno-17-39">39</a></span>
<span class="normal"><a href="#__codelineno-17-40">40</a></span>
<span class="normal"><a href="#__codelineno-17-41">41</a></span>
<span class="normal"><a href="#__codelineno-17-42">42</a></span>
<span class="normal"><a href="#__codelineno-17-43">43</a></span>
<span class="normal"><a href="#__codelineno-17-44">44</a></span>
<span class="normal"><a href="#__codelineno-17-45">45</a></span>
<span class="normal"><a href="#__codelineno-17-46">46</a></span>
<span class="normal"><a href="#__codelineno-17-47">47</a></span>
<span class="normal"><a href="#__codelineno-17-48">48</a></span>
<span class="normal"><a href="#__codelineno-17-49">49</a></span>
<span class="normal"><a href="#__codelineno-17-50">50</a></span>
<span class="normal"><a href="#__codelineno-17-51">51</a></span>
<span class="normal"><a href="#__codelineno-17-52">52</a></span>
<span class="normal"><a href="#__codelineno-17-53">53</a></span>
<span class="normal"><a href="#__codelineno-17-54">54</a></span>
<span class="normal"><a href="#__codelineno-17-55">55</a></span>
<span class="normal"><a href="#__codelineno-17-56">56</a></span>
<span class="normal"><a href="#__codelineno-17-57">57</a></span>
<span class="normal"><a href="#__codelineno-17-58">58</a></span>
<span class="normal"><a href="#__codelineno-17-59">59</a></span>
<span class="normal"><a href="#__codelineno-17-60">60</a></span>
<span class="normal"><a href="#__codelineno-17-61">61</a></span>
<span class="normal"><a href="#__codelineno-17-62">62</a></span>
<span class="normal"><a href="#__codelineno-17-63">63</a></span>
<span class="normal"><a href="#__codelineno-17-64">64</a></span>
<span class="normal"><a href="#__codelineno-17-65">65</a></span>
<span class="normal"><a href="#__codelineno-17-66">66</a></span>
<span class="normal"><a href="#__codelineno-17-67">67</a></span>
<span class="normal"><a href="#__codelineno-17-68">68</a></span>
<span class="normal"><a href="#__codelineno-17-69">69</a></span>
<span class="normal"><a href="#__codelineno-17-70">70</a></span>
<span class="normal"><a href="#__codelineno-17-71">71</a></span>
<span class="normal"><a href="#__codelineno-17-72">72</a></span>
<span class="normal"><a href="#__codelineno-17-73">73</a></span>
<span class="normal"><a href="#__codelineno-17-74">74</a></span>
<span class="normal"><a href="#__codelineno-17-75">75</a></span>
<span class="normal"><a href="#__codelineno-17-76">76</a></span>
<span class="normal"><a href="#__codelineno-17-77">77</a></span>
<span class="normal"><a href="#__codelineno-17-78">78</a></span>
<span class="normal"><a href="#__codelineno-17-79">79</a></span>
<span class="normal"><a href="#__codelineno-17-80">80</a></span>
<span class="normal"><a href="#__codelineno-17-81">81</a></span>
<span class="normal"><a href="#__codelineno-17-82">82</a></span>
<span class="normal"><a href="#__codelineno-17-83">83</a></span>
<span class="normal"><a href="#__codelineno-17-84">84</a></span>
<span class="normal"><a href="#__codelineno-17-85">85</a></span>
<span class="normal"><a href="#__codelineno-17-86">86</a></span>
<span class="normal"><a href="#__codelineno-17-87">87</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">import</span> <span class="nn">random</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kn">import</span> <span class="nn">string</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="kn">from</span> <span class="nn">tornado.ioloop</span> <span class="kn">import</span> <span class="n">IOLoop</span>
<a id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="kn">from</span> <span class="nn">tornado.web</span> <span class="kn">import</span> <span class="n">Application</span><span class="p">,</span> <span class="n">HTTPError</span><span class="p">,</span> <span class="n">RequestHandler</span>
<a id="__codelineno-17-8" name="__codelineno-17-8"></a>
<a id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="kn">from</span> <span class="nn">pait.app.tornado</span> <span class="kn">import</span> <span class="n">pait</span>
<a id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="kn">from</span> <span class="nn">pait.app.tornado.security</span> <span class="kn">import</span> <span class="n">oauth2</span>
<a id="__codelineno-17-11" name="__codelineno-17-11"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Depends</span>
<a id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="kn">from</span> <span class="nn">pait.model.response</span> <span class="kn">import</span> <span class="n">Http400RespModel</span>
<a id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="kn">from</span> <span class="nn">pait.openapi.doc_route</span> <span class="kn">import</span> <span class="n">AddDocRoute</span>
<a id="__codelineno-17-14" name="__codelineno-17-14"></a>
<a id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
<a id="__codelineno-17-16" name="__codelineno-17-16"></a>    <span class="kn">from</span> <span class="nn">pait.app.base.security.oauth2</span> <span class="kn">import</span> <span class="n">BaseOAuth2PasswordBearerProxy</span>
<a id="__codelineno-17-17" name="__codelineno-17-17"></a>
<a id="__codelineno-17-18" name="__codelineno-17-18"></a>
<a id="__codelineno-17-19" name="__codelineno-17-19"></a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-17-20" name="__codelineno-17-20"></a>    <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user id&quot;</span><span class="p">)</span>
<a id="__codelineno-17-21" name="__codelineno-17-21"></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user name&quot;</span><span class="p">)</span>
<a id="__codelineno-17-22" name="__codelineno-17-22"></a>    <span class="n">age</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user age&quot;</span><span class="p">)</span>
<a id="__codelineno-17-23" name="__codelineno-17-23"></a>    <span class="n">sex</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user sex&quot;</span><span class="p">)</span>
<a id="__codelineno-17-24" name="__codelineno-17-24"></a>    <span class="n">scopes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;user scopes&quot;</span><span class="p">)</span>
<a id="__codelineno-17-25" name="__codelineno-17-25"></a>
<a id="__codelineno-17-26" name="__codelineno-17-26"></a>
<a id="__codelineno-17-27" name="__codelineno-17-27"></a><span class="n">temp_token_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-17-28" name="__codelineno-17-28"></a>
<a id="__codelineno-17-29" name="__codelineno-17-29"></a>
<a id="__codelineno-17-30" name="__codelineno-17-30"></a><span class="k">class</span> <span class="nc">OAuth2LoginHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
<a id="__codelineno-17-31" name="__codelineno-17-31"></a>    <span class="nd">@pait</span><span class="p">(</span>
<a id="__codelineno-17-32" name="__codelineno-17-32"></a>        <span class="n">response_model_list</span><span class="o">=</span><span class="p">[</span><span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearerJsonRespModel</span><span class="p">,</span> <span class="n">Http400RespModel</span><span class="p">],</span>
<a id="__codelineno-17-33" name="__codelineno-17-33"></a>    <span class="p">)</span>
<a id="__codelineno-17-34" name="__codelineno-17-34"></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">form_data</span><span class="p">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordRequestFrom</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-17-35" name="__codelineno-17-35"></a>        <span class="k">if</span> <span class="n">form_data</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">form_data</span><span class="o">.</span><span class="n">password</span><span class="p">:</span>
<a id="__codelineno-17-36" name="__codelineno-17-36"></a>            <span class="k">raise</span> <span class="n">HTTPError</span><span class="p">(</span><span class="mi">400</span><span class="p">)</span>
<a id="__codelineno-17-37" name="__codelineno-17-37"></a>        <span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<a id="__codelineno-17-38" name="__codelineno-17-38"></a>        <span class="n">temp_token_dict</span><span class="p">[</span><span class="n">token</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">uid</span><span class="o">=</span><span class="s2">&quot;123&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">form_data</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">sex</span><span class="o">=</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="n">scopes</span><span class="o">=</span><span class="n">form_data</span><span class="o">.</span><span class="n">scope</span><span class="p">)</span>
<a id="__codelineno-17-39" name="__codelineno-17-39"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearerJsonRespModel</span><span class="o">.</span><span class="n">response_data</span><span class="p">(</span><span class="n">access_token</span><span class="o">=</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
<a id="__codelineno-17-40" name="__codelineno-17-40"></a>
<a id="__codelineno-17-41" name="__codelineno-17-41"></a>
<a id="__codelineno-17-42" name="__codelineno-17-42"></a><span class="n">oauth2_pb</span><span class="p">:</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearer</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">OAuth2PasswordBearer</span><span class="p">(</span>
<a id="__codelineno-17-43" name="__codelineno-17-43"></a>    <span class="n">route</span><span class="o">=</span><span class="n">OAuth2LoginHandler</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
<a id="__codelineno-17-44" name="__codelineno-17-44"></a>    <span class="n">scopes</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-17-45" name="__codelineno-17-45"></a>        <span class="s2">&quot;user-info&quot;</span><span class="p">:</span> <span class="s2">&quot;get all user info&quot;</span><span class="p">,</span>
<a id="__codelineno-17-46" name="__codelineno-17-46"></a>        <span class="s2">&quot;user-name&quot;</span><span class="p">:</span> <span class="s2">&quot;only get user name&quot;</span><span class="p">,</span>
<a id="__codelineno-17-47" name="__codelineno-17-47"></a>    <span class="p">},</span>
<a id="__codelineno-17-48" name="__codelineno-17-48"></a><span class="p">)</span>
<a id="__codelineno-17-49" name="__codelineno-17-49"></a>
<a id="__codelineno-17-50" name="__codelineno-17-50"></a>
<a id="__codelineno-17-51" name="__codelineno-17-51"></a><span class="k">def</span> <span class="nf">get_current_user</span><span class="p">(</span><span class="n">_oauth2_pb</span><span class="p">:</span> <span class="s2">&quot;BaseOAuth2PasswordBearerProxy&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="n">User</span><span class="p">]:</span>
<a id="__codelineno-17-52" name="__codelineno-17-52"></a>    <span class="k">def</span> <span class="nf">_check_scope</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">i</span><span class="p">(</span><span class="n">_oauth2_pb</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
<a id="__codelineno-17-53" name="__codelineno-17-53"></a>        <span class="n">user_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">User</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_token_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-17-54" name="__codelineno-17-54"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_model</span><span class="p">:</span>
<a id="__codelineno-17-55" name="__codelineno-17-55"></a>            <span class="k">raise</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">not_authenticated_exc</span>
<a id="__codelineno-17-56" name="__codelineno-17-56"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">is_allow</span><span class="p">(</span><span class="n">user_model</span><span class="o">.</span><span class="n">scopes</span><span class="p">):</span>
<a id="__codelineno-17-57" name="__codelineno-17-57"></a>            <span class="k">raise</span> <span class="n">_oauth2_pb</span><span class="o">.</span><span class="n">security</span><span class="o">.</span><span class="n">not_authenticated_exc</span>
<a id="__codelineno-17-58" name="__codelineno-17-58"></a>        <span class="k">return</span> <span class="n">user_model</span>
<a id="__codelineno-17-59" name="__codelineno-17-59"></a>
<a id="__codelineno-17-60" name="__codelineno-17-60"></a>    <span class="k">return</span> <span class="n">_check_scope</span>
<a id="__codelineno-17-61" name="__codelineno-17-61"></a>
<a id="__codelineno-17-62" name="__codelineno-17-62"></a>
<a id="__codelineno-17-63" name="__codelineno-17-63"></a><span class="k">class</span> <span class="nc">OAuth2UserNameHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
<a id="__codelineno-17-64" name="__codelineno-17-64"></a>    <span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-17-65" name="__codelineno-17-65"></a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_model</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">(</span><span class="n">oauth2_pb</span><span class="o">.</span><span class="n">get_depend</span><span class="p">([</span><span class="s2">&quot;user-name&quot;</span><span class="p">]))))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-17-66" name="__codelineno-17-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_model</span><span class="o">.</span><span class="n">name</span><span class="p">})</span>
<a id="__codelineno-17-67" name="__codelineno-17-67"></a>
<a id="__codelineno-17-68" name="__codelineno-17-68"></a>
<a id="__codelineno-17-69" name="__codelineno-17-69"></a><span class="k">class</span> <span class="nc">OAuth2UserInfoHandler</span><span class="p">(</span><span class="n">RequestHandler</span><span class="p">):</span>
<a id="__codelineno-17-70" name="__codelineno-17-70"></a>    <span class="nd">@pait</span><span class="p">()</span>
<a id="__codelineno-17-71" name="__codelineno-17-71"></a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_model</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">Depends</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">(</span><span class="n">oauth2_pb</span><span class="o">.</span><span class="n">get_depend</span><span class="p">([</span><span class="s2">&quot;user-info&quot;</span><span class="p">]))))</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-17-72" name="__codelineno-17-72"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;code&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;msg&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">user_model</span><span class="o">.</span><span class="n">dict</span><span class="p">()})</span>
<a id="__codelineno-17-73" name="__codelineno-17-73"></a>
<a id="__codelineno-17-74" name="__codelineno-17-74"></a>
<a id="__codelineno-17-75" name="__codelineno-17-75"></a><span class="n">app</span><span class="p">:</span> <span class="n">Application</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span>
<a id="__codelineno-17-76" name="__codelineno-17-76"></a>    <span class="p">[</span>
<a id="__codelineno-17-77" name="__codelineno-17-77"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/oauth2-login&quot;</span><span class="p">,</span> <span class="n">OAuth2LoginHandler</span><span class="p">),</span>
<a id="__codelineno-17-78" name="__codelineno-17-78"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/oauth2-user-name&quot;</span><span class="p">,</span> <span class="n">OAuth2UserNameHandler</span><span class="p">),</span>
<a id="__codelineno-17-79" name="__codelineno-17-79"></a>        <span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/api/security/oauth2-user-info&quot;</span><span class="p">,</span> <span class="n">OAuth2UserInfoHandler</span><span class="p">),</span>
<a id="__codelineno-17-80" name="__codelineno-17-80"></a>    <span class="p">],</span>
<a id="__codelineno-17-81" name="__codelineno-17-81"></a><span class="p">)</span>
<a id="__codelineno-17-82" name="__codelineno-17-82"></a><span class="n">AddDocRoute</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<a id="__codelineno-17-83" name="__codelineno-17-83"></a>
<a id="__codelineno-17-84" name="__codelineno-17-84"></a>
<a id="__codelineno-17-85" name="__codelineno-17-85"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<a id="__codelineno-17-86" name="__codelineno-17-86"></a>    <span class="n">app</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">8000</span><span class="p">)</span>
<a id="__codelineno-17-87" name="__codelineno-17-87"></a>    <span class="n">IOLoop</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>The first part is to create a Model -- <code>User</code>  about the user's data and a <code>temp_token_dict</code> with <code>key</code> as token <code>value</code> as <code>User</code> to be used to mocker database storage.</p>
<p>The second part is to create a standard login route function that takes a parameter of type <code>OAuth2PasswordRequestFrom</code>,
which is <code>Pait</code>'s encapsulation of <code>Oauth2</code>'s login parameters, and which has the following source code:
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kn">from</span> <span class="nn">pait.field</span> <span class="kn">import</span> <span class="n">Form</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="k">class</span> <span class="nc">BaseOAuth2PasswordRequestFrom</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Form</span><span class="p">()</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Form</span><span class="p">()</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>    <span class="n">scope</span><span class="p">:</span> <span class="n">ScopeType</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="n">client_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>    <span class="n">client_secret</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="k">class</span> <span class="nc">OAuth2PasswordRequestFrom</span><span class="p">(</span><span class="n">BaseOAuth2PasswordRequestFrom</span><span class="p">):</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>    <span class="n">grant_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Form</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
</code></pre></div>
can see that <code>OAuth2PasswordRequestFrom</code> inherits <code>BaseModel</code> and uses <code>Form</code> for the <code>Field</code> of all its parameters,
which means that its parameters get data from the form in the request body.
While the login route function simply checks the data after receiving it,
and returns a 400 response if the check is wrong.
If it passes, it generates a <code>token</code> and stores the <code>token</code> and <code>User</code> in <code>temp_token_dict</code> and returns the Oauth2 standard response via <code>oauth2.OAuth2PasswordBearerJsonRespModel</code>.</p>
<p>The third part is the creation of an instance of <code>oauth2_pb</code> via <code>oauth2.OAuth2PasswordBearer</code> as well as the creation of a function  -- <code>get-current_user</code>to get the user.
The <code>scopes</code> parameter to create <code>oauth2_pb</code> is the permission description of <code>oauth2_pb</code> and the <code>route</code> parameter is the login route function,
when the route function registers with the web framework, <code>oauth2_pb</code> will find the URL of the route function and writes it to the <code>tokenUrl</code> attribute.
The <code>get_current_user</code> function will get the current user through the Token, and then through the <code>is_allow</code> method to determine whether the current user has permission to access the route function,
if not, then return a 403 response, if so, then return <code>User</code> Model.
Note that the <code>get_current_user</code> function receives the value of the <code>oauth2.OAuth2PasswordBearer</code> proxy class,
which already specifies only which permissions are allowed(by <code>oauth2_pb.get_depend</code> method).
In addition, the class has two functions, one that passes the requested parameters to the function via <code>Depend</code>,
and the other that provides the <code>is_allow</code> method for determining whether the user has permission to access the interface.</p>
<p>The fourth part is the route functions, which use the <code>get_current_user</code> function created in the third part.
where <code>oauth2_pb.get_depend(["user-name"])</code> creates an instance of a proxy that only allows access with <code>user-name</code> privileges, via <code>oauth2.OAuth2PasswordBearer</code>.
<code>oauth2_pb.get_depend(["user-info"])</code> will create a proxy instance that only allows access with <code>user-info</code> permissions via <code>oauth2.OAuth2PasswordBearer</code>.
The only difference between them is that the <code>scopes</code> are different.</p>
<p>After running the code, run the <code>curl</code> command to see them executed as follows:
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>➜<span class="w">  </span>curl<span class="w"> </span><span class="s1">&#39;http://127.0.0.1:8000/api/oauth2-login&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">  </span>--data-raw<span class="w"> </span><span class="s1">&#39;grant_type=password&amp;scope=user-info&amp;username=so1n&amp;password=so1n&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="o">{</span><span class="s2">&quot;access_token&quot;</span>:<span class="s2">&quot;pomeG4jCDh&quot;</span>,<span class="s2">&quot;token_type&quot;</span>:<span class="s2">&quot;bearer&quot;</span><span class="o">}</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>➜<span class="w">  </span>curl<span class="w"> </span><span class="s1">&#39;http://127.0.0.1:8000/api/oauth2-login&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">  </span>--data-raw<span class="w"> </span><span class="s1">&#39;grant_type=password&amp;scope=user-name&amp;username=so1n1&amp;password=so1n1&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a><span class="o">{</span><span class="s2">&quot;access_token&quot;</span>:<span class="s2">&quot;G8ckqKGkDO&quot;</span>,<span class="s2">&quot;token_type&quot;</span>:<span class="s2">&quot;bearer&quot;</span><span class="o">}</span>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/oauth2-user-info&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Bearer pomeG4jCDh&#39;</span>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a><span class="o">{</span><span class="s2">&quot;code&quot;</span>:0,<span class="s2">&quot;data&quot;</span>:<span class="o">{</span><span class="s2">&quot;age&quot;</span>:23,<span class="s2">&quot;name&quot;</span>:<span class="s2">&quot;so1n&quot;</span>,<span class="s2">&quot;scopes&quot;</span>:<span class="o">[</span><span class="s2">&quot;user-info&quot;</span><span class="o">]</span>,<span class="s2">&quot;sex&quot;</span>:<span class="s2">&quot;M&quot;</span>,<span class="s2">&quot;uid&quot;</span>:<span class="s2">&quot;123&quot;</span><span class="o">}</span>,<span class="s2">&quot;msg&quot;</span>:<span class="s2">&quot;&quot;</span><span class="o">}</span>
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/oauth2-user-info&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Bearer G8ckqKGkDO&#39;</span>
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>&lt;!DOCTYPE<span class="w"> </span>HTML<span class="w"> </span>PUBLIC<span class="w"> </span><span class="s2">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span>&gt;
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>&lt;title&gt;401<span class="w"> </span>Unauthorized&lt;/title&gt;
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>&lt;h1&gt;Unauthorized&lt;/h1&gt;
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a>&lt;p&gt;Not<span class="w"> </span>authenticated&lt;/p&gt;
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/oauth2-user-name&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Bearer pomeG4jCDh&#39;</span>
<a id="__codelineno-19-34" name="__codelineno-19-34" href="#__codelineno-19-34"></a>
<a id="__codelineno-19-35" name="__codelineno-19-35" href="#__codelineno-19-35"></a>&lt;!DOCTYPE<span class="w"> </span>HTML<span class="w"> </span>PUBLIC<span class="w"> </span><span class="s2">&quot;-//W3C//DTD HTML 3.2 Final//EN&quot;</span>&gt;
<a id="__codelineno-19-36" name="__codelineno-19-36" href="#__codelineno-19-36"></a>&lt;title&gt;401<span class="w"> </span>Unauthorized&lt;/title&gt;
<a id="__codelineno-19-37" name="__codelineno-19-37" href="#__codelineno-19-37"></a>&lt;h1&gt;Unauthorized&lt;/h1&gt;
<a id="__codelineno-19-38" name="__codelineno-19-38" href="#__codelineno-19-38"></a>&lt;p&gt;Not<span class="w"> </span>authenticated&lt;/p&gt;
<a id="__codelineno-19-39" name="__codelineno-19-39" href="#__codelineno-19-39"></a>
<a id="__codelineno-19-40" name="__codelineno-19-40" href="#__codelineno-19-40"></a>➜<span class="w">  </span>curl<span class="w"> </span>-X<span class="w"> </span><span class="s1">&#39;GET&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-41" name="__codelineno-19-41" href="#__codelineno-19-41"></a><span class="w">  </span><span class="s1">&#39;http://127.0.0.1:8000/api/oauth2-user-name&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-42" name="__codelineno-19-42" href="#__codelineno-19-42"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;accept: */*&#39;</span><span class="w"> </span><span class="se">\</span>
<a id="__codelineno-19-43" name="__codelineno-19-43" href="#__codelineno-19-43"></a><span class="w">  </span>-H<span class="w"> </span><span class="s1">&#39;Authorization: Bearer G8ckqKGkDO&#39;</span>
<a id="__codelineno-19-44" name="__codelineno-19-44" href="#__codelineno-19-44"></a><span class="o">{</span><span class="s2">&quot;code&quot;</span>:0,<span class="s2">&quot;data&quot;</span>:<span class="s2">&quot;so1n1&quot;</span>,<span class="s2">&quot;msg&quot;</span>:<span class="s2">&quot;&quot;</span><span class="o">}</span>
</code></pre></div>
The response result shows that a user with permission <code>user-info</code> can only access <code>/api/oauth2-user-info</code>,
while a user with permission <code>user-name</code> can only access <code>/api/oauth2-user-name</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The current version does not support <code>refresh Url</code> yet</p>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/so1n" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "navigation.top", "navigation.path", "search.highlight", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.81fa17fe.min.js"></script>
      
        <script src="../termynal.js"></script>
      
    
  </body>
</html>