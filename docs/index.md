# Introduction
`Pait` is a Python API development tool that helps developers quickly write API route functions.
It has feature such as parameter type checking, type conversion, and automatic API documentation.
It is suitable for back-end interface development.

In addition, it is designed as an adapter that can work with multiple Python web application frameworks (see [Web Framework Support](/#web-framework-support) for details),
Based on `Pait`, can quickly develop applications that adapt to each WEB framework without considering the differences of different WEB frameworks, such as [grpc-gateway](https://github.com/python-pai/grpc-gateway).


## Feature
 - [x] Integrate into the Type Hints ecosystem to provide a safe and efficient API interface coding method.
 - [x] Automatic verification and type conversion of request parameters (depends on `Pydantic` and `inspect`, currently supports `Pydantic` V1 and V2 versions).
 - [x] Automatically generate openapi files and support UI components such as `Swagger`,`Redoc`,`RapiDoc` and `Elements`.
 - [x] TestClient support, response result verification of test cases。
 - [x] Plugin expansion, such as parameter relationship dependency verification, Mock response, etc.。
 - [x] gRPC GateWay (After version 1.0, this feature has been migrated to [grpc-gateway](https://github.com/python-pai/grpc-gateway))
 - [ ] Automated API testing
 - [ ] WebSocket support
 - [ ] SSE support

## Install
!!! note
    Only supports Python 3.8+ version

```bash
pip install pait --pre
```

## Usage
### Parameter verification and document generation
The main feature of `Pait` is to provide parameter verification and document generation. The usage is very simple, as follows:

=== "Flask"

    ```py linenums="1" title="docs_source_code/introduction/flask_demo.py" hl_lines="21 23-24 31"

    --8<-- "docs_source_code/introduction/flask_demo.py"
    ```

=== "Starlette"

    ```py linenums="1" title="docs_source_code/introduction/starlette_demo.py" hl_lines="23 25-26 32"
    --8<-- "docs_source_code/introduction/starlette_demo.py"
    ```

=== "Sanic"

    ```py linenums="1" title="docs_source_code/introduction/sanic_demo.py" hl_lines="22 24-25 32"
    --8<-- "docs_source_code/introduction/sanic_demo.py"
    ```

=== "Tornado"

    ```py linenums="1" title="docs_source_code/introduction/tornado_demo.py" hl_lines="23 24-25 33"
    --8<-- "docs_source_code/introduction/tornado_demo.py"
    ```

There are three sections of highlighted code in the example code.
The `@pait` in the first highlighted code will decorate the route function and automatically extract the request parameter data from the route function when the program starts.
In addition, the response object of the route function is declared as `DemoResponseModel` through the `response_model_list` attribute.
The `description` and `response_data` attributes of the `DemoResponseModel` object are used to describe the response object description of the route function and the structure type of the response object respectively.


The parameter format of the route function in the second highlighted code is a format that conforms to the `Pait` specification.
During initialization, `@pait` will actively parse the route function and generate dependency injection rules based on the function signature of the route function.
When a request hits the route function, `Pait` will get the corresponding value from the `Request` object according to the dependency injection rules and inject it into the route function.

The main job of the highlighted code in the third paragraph is to register the `OpenAPI` route with the `app` instance and provide the `OpenAPI` document feature for the web framework.

After everything is ready, start running the code and visit: [http://127.0.0.1:8000/swagger](http://127.0.0.1:8000/swagger) in the browser to see the SwaggerUI page.
Two sets of interfaces will be displayed as shown below:
![](https://cdn.jsdelivr.net/gh/so1n/so1n_blog_photo@master/blog_photo/1648292884021Pait%20doc-%E9%A6%96%E9%A1%B5%E7%A4%BA%E4%BE%8B%E6%8E%A5%E5%8F%A3-Swagger%E9%A6%96%E9%A1%B5.png)

The named `pait_doc` belongs to the `OpenAPI` interface that comes with `Pait`,
and the other group is the `default` containing the newly created `/api`.
After clicking on the `/api`, it will Pop-up interface details:
![](https://cdn.jsdelivr.net/gh/so1n/so1n_blog_photo@master/blog_photo/1648292937018Pait%20doc-%E9%A6%96%E9%A1%B5%E7%A4%BA%E4%BE%8B%E6%8E%A5%E5%8F%A3-api%E6%8E%A5%E5%8F%A3.png)

The data is generated by `Pait` parse the route's function signature and the `DemoResponseModel` object.
In the details page, you can click the `try it out` button,
then enter the parameters and click the `Excute` button, you can see the `curl` command generation results and the server response results, as shown below:
![](https://cdn.jsdelivr.net/gh/so1n/so1n_blog_photo@master/blog_photo/1648292980016Pait%20doc-%E9%A6%96%E9%A1%B5%E7%A4%BA%E4%BE%8B%E6%8E%A5%E5%8F%A3-Swagger%E8%AF%B7%E6%B1%82.png)


!!! note
    Want to know more? Immediately enter the [Type Conversion and Parameter Verification](/1_1_introduction/) chapter


### Plugin
In addition to parameter verification and `OpenAPI` feature, `Pait` can also expand its feature through the plugin system.
For example, the Mock response plugin can automatically generate response values and return data based on the response model,
even if the route function does not have any logic implementation, such as the following code:
=== "Flask"

    ```py linenums="1" title="docs_source_code/introduction/flask_demo_with_mock_plugin.py" hl_lines="15 22"

    --8<-- "docs_source_code/introduction/flask_demo_with_mock_plugin.py"
    ```

=== "Starlette"

    ```py linenums="1" title="docs_source_code/introduction/starlette_demo_with_mock_plugin.py" hl_lines="17 24"
    --8<-- "docs_source_code/introduction/starlette_demo_with_mock_plugin.py"
    ```

=== "Sanic"

    ```py linenums="1" title="docs_source_code/introduction/sanic_demo_with_mock_plugin.py" hl_lines="16 23"
    --8<-- "docs_source_code/introduction/sanic_demo_with_mock_plugin.py"
    ```

=== "Tornado"

    ```py linenums="1" title="docs_source_code/introduction/tornado_demo_with_mock_plugin.py" hl_lines="16 24"
    --8<-- "docs_source_code/introduction/tornado_demo_with_mock_plugin.py"
    ```

This code is changed based on the code of [Parameter verification and document generation](/#parameter-verification-and-document-generation).
It removes the logic code of the route function and introduces the highlighted part of the code.

Among them, the `uid: int = Field(example=999)` of the `DemoResponseModel` response model specifies that the mock value of uid in the response structure is 999.
The `@pait` decorator adds a plugin named `MockPlugin` through the `plugin_list` attribute.
The plugin can generate a mock response based on the `response_model_list`.

After everything is ready, start running the code and re-click the `Excute` button on the `Swagger` page or run the `curl` command generated by the `Swagger` page in the terminal:
```bash
> curl -X 'POST' \
  'http://127.0.0.1:8000/api' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "uid": 666,
  "user_name": "so1n"
}'
```
Finally, can see the following output whether on the `Swagger` page or in the terminal:
```bash
{"uid":999,"username":""}
```
As you can see from the returned results, although the route function does not perform any operation, the routeing function can still return a response.

This response result is automatically generated by the Mock plugin,
where the `uid` value of `999` is the same as the value set in the `uid: int = Field(example=999)` in the response model,
and the `username` is the default empty string in the response result because it is not set in `example`.

!!! note
    In addition to the `MockPlugin`, `Pait` also has other plugins and feature.
    For details, please see the description of [Plugin](/5_1_introduction/).

## Performance
The main operating principle of `Pait` is to convert the function signature of the route function into `Pydantic Model` through the reflection mechanism when the program is started,
and then verify and convert the request parameters through `Pydantic Model` when the request hits the route.

These two stages are all automatically handled internally by `Pait`.
The first stage only slightly increases the startup time of the program, while the second stage increases the response time of the routing, but it only consumes 0.00005(s) more than manual processing.
The specific benchmark data and subsequent optimization are described in [#27](https://github.com/so1n/pait/issues/27).

## Web framework support
The internal implementation of `Pait` is an adapter that adapts to different web frameworks, and implements various feature based on the adapter.
Currently, the web frameworks supported by the `Pait` adapter are as follows:

| Web Framework |Request|Response|Plugin|OpenAPI|App attribute set&get|HTTP Exception|SimpleRoute|TestHelper|
|---------------|---|---|---|---|---|---|---|---|
| Flask         |√|√|√|√|√|√|√|√|
| Sanic         |√|√|√|√|√|√|√|√|
| Startlette    |√|√|√|√|√|√|√|√|
| Tornado       |√|√|√|√|√|√|√|√|

## Example
`Pait` provides complete code examples for the web frameworks it supports, can learn more by accessing the sample code:

- [flask example](https://github.com/so1n/pait/tree/master/example/flask_example)

- [sanic example](https://github.com/so1n/pait/tree/master/example/sanic_example)

- [starlette example](https://github.com/so1n/pait/tree/master/example/starlette_example)

- [tornado example](https://github.com/so1n/pait/tree/master/example/tornado_example)
